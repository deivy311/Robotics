Robotics 2

Trajectory Tracking Control
Prof. Alessandro De Luca

Inverse dynamics control
given the robot dynamic model

ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘› ğ‘, ğ‘Ì‡ = ğ‘¢
ğ‘ ğ‘, ğ‘Ì‡ + ğ‘” ğ‘ + friction model
and a twice-differentiable desired trajectory for ğ‘¡ âˆˆ [0, ğ‘‡]

ğ‘, ğ‘¡

â†’ ğ‘Ì‡ , ğ‘¡ , ğ‘Ìˆ , (ğ‘¡)

applying the feedforward torque in nominal conditions

ğ‘¢, = ğ‘€ ğ‘, ğ‘Ìˆ , + ğ‘›(ğ‘, , ğ‘Ì‡ , )
yields exact reproduction of the desired motion, provided
that ğ‘(0) = ğ‘, (0), ğ‘(0)
Ì‡
= ğ‘Ì‡ , (0) (initial matched state)
Robotics 2

2

In practice ...
a number of differences from the nominal condition
n
n
n

n
n

initial state is â€œnot matchedâ€ to the desired trajectory ğ‘, (ğ‘¡)
disturbances on the actuators, truncation errors on data, â€¦
inaccurate knowledge of robot dynamic parameters (link
masses, inertias, center of mass positions)
unknown value of the carried payload
presence of unmodeled dynamics (complex friction
phenomena, transmission elasticity, â€¦)

Robotics 2

3

Introducing feedback
6 ğ‘, ğ‘Ìˆ , + ğ‘›(ğ‘
ğ‘¢7 , = ğ‘€
7 , , ğ‘Ì‡ , )
note:

6 ğ‘›7 estimates of terms
with ğ‘€,
(or coefficients) in the dynamic model

8 ; (ğ‘, , ğ‘Ì‡ , , ğ‘Ìˆ , )]
ğ‘¢7 , can be computed off line [e.g., by ğ‘ğ¸

feedback is introduced to make the control scheme more robust
different possible implementations depending on
amount of computational load share
Â§ OFF LINE (

open loop)

Â§ ON LINE (

closed loop)

two-step control design:
1. compensation (feedforward) or cancellation (feedback) of nonlinearities
2. synthesis of a linear control law stabilizing the trajectory error to zero
Robotics 2

4

A series of trajectory controllers
1. inverse dynamics compensation (FFW) + PD

ğ‘¢ = ğ‘¢7 , + ğ¾? ğ‘, âˆ’ ğ‘ + ğ¾@ (ğ‘Ì‡ , âˆ’ ğ‘)
Ì‡

typically, only local
stabilization of
trajectory error
ğ‘’(ğ‘¡) = ğ‘, (ğ‘¡) âˆ’ ğ‘(ğ‘¡)

2. inverse dynamics compensation (FFW) + variable PD

6 ğ‘, ğ¾? ğ‘, âˆ’ ğ‘ + ğ¾@ (ğ‘Ì‡ , âˆ’ ğ‘)
ğ‘¢ = ğ‘¢7 , + ğ‘€
Ì‡
3. feedback linearization (FBL) + [PD+FFW] = â€œCOMPUTED TORQUEâ€

6 ğ‘ ğ‘Ìˆ , + ğ¾? ğ‘, âˆ’ ğ‘ + ğ¾@ (ğ‘Ì‡ , âˆ’ ğ‘)
ğ‘¢=ğ‘€
Ì‡ + ğ‘›(ğ‘,
7 ğ‘)
Ì‡
4. feedback linearization (FBL) + [PID+FFW]
6 ğ‘
ğ‘¢=ğ‘€

ğ‘Ìˆ , + ğ¾? ğ‘, âˆ’ ğ‘ + ğ¾@ ğ‘Ì‡ , âˆ’ ğ‘Ì‡ + ğ¾A B ğ‘, âˆ’ ğ‘ ğ‘‘ğ‘¡ + ğ‘›(ğ‘,
7 ğ‘)
Ì‡

more robust to uncertainties, but also more complex to implement in real time
Robotics 2

5

Feedback linearization control
ROBOT (or its DYNAMIC MODEL)

ğ‘Ìˆ , + ğ¾@ ğ‘Ì‡ ,
+ ğ¾? ğ‘,

ğ‘ 6
ğ‘€(ğ‘)

+
_

+

ğ‘¢

+
_

+

ğ‘€ DE (ğ‘)

ğ‘Ìˆ

ğ‘Ì‡

ğ‘

ğ‘›(ğ‘, ğ‘)
Ì‡
symmetric and
positive definite
matrices ğ¾? , ğ¾@

in nominal
conditions
6 = ğ‘€, ğ‘›7 = ğ‘›)
(ğ‘€

ğ‘›(ğ‘,
7 ğ‘)
Ì‡
ğ¾@
ğ¾?

ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘› ğ‘, ğ‘Ì‡ = ğ‘¢ = ğ‘€ ğ‘ ğ‘ + ğ‘› ğ‘, ğ‘Ì‡
nonlinear robot dynamics

nonlinear control law

global asymptotic
ğ‘ = ğ‘Ìˆ , + ğ¾@ ğ‘Ì‡ , âˆ’ ğ‘Ì‡ + ğ¾? ğ‘, âˆ’ ğ‘
stabilization
Robotics 2

ğ‘Ìˆ = ğ‘
linear and
decoupled
system
6

Interpretation in the linear domain
ğ‘Ìˆ , + ğ¾@ ğ‘Ì‡ , + ğ¾? ğ‘,
> 0, diagonal

ğ‘ = ğ‘Ìˆ

+

ğ‘

ğ‘Ì‡

_

ğ¾@

ğ¾?

under feedback linearization control, the robot has a dynamic behavior that is
invariant, linear and decoupled in its whole workspace (âˆ€(ğ‘, ğ‘)
Ì‡ )

linearity

a unitary mass (ğ‘š = 1) in the joint space !!

error transients ğ‘’I = ğ‘,I âˆ’ ğ‘I â†’ 0 exponentially, prescribed by ğ¾?I , ğ¾@I choice

decoupling
each joint coordinate ğ‘I evolves independently from the others, forced by ğ‘I
Robotics 2

ğ‘’Ìˆ + ğ¾@ ğ‘’Ì‡ + ğ¾? ğ‘’ = 0 âŸº ğ‘’ÌˆI +ğ¾@I ğ‘’IÌ‡ + ğ¾?I ğ‘’I = 0

7

Addition of an integral term: PID
whiteboardâ€¦

ğ‘Ìˆ , + ğ¾@ ğ‘Ì‡ , + ğ¾? ğ‘,
ğ‘, +
ğ‘’
ğ¾A
_
â‡’ ğ¾?I > 0, ğ¾@I > 0,
0 < ğ¾AI < ğ¾?I ğ¾@I

+
+

+
_

ğ‘ = ğ‘Ìˆ

ğ‘Ì‡

ğ¾@

> 0,
diagonal

ğ¾?

ğ‘Ìˆ = ğ‘ = ğ‘Ìˆ , + ğ¾@ ğ‘Ì‡ , âˆ’ ğ‘Ì‡ + ğ¾? ğ‘, âˆ’ ğ‘ + ğ¾A B ğ‘, âˆ’ ğ‘ ğ‘‘ğœ
â‡’ ğ‘’I = ğ‘,I âˆ’ ğ‘I (ğ‘– = 1, . . , ğ‘)

(1)

ğ‘

ğ‘’ = ğ‘, âˆ’ ğ‘

â‡’ ğ‘’ÌˆI + ğ¾@I ğ‘’Ì‡I + ğ¾?I ğ‘’I + ğ¾?I B ğ‘’I ğ‘‘ğœ = 0

(2)

1
â‡’(6)
ğ‘’I ğ‘  = 0 3
1
ğ¾?I
exponential
(3)
ğ‘ 
2
ğ¾@I
ğ¾AI
stability
T
R
â‡’
(ğ¾
ğ¾
âˆ’
ğ¾
)/ğ¾
â‡’
ğ‘  + ğ¾@I ğ‘  + ğ¾?I ğ‘  + ğ¾AI ğ‘’I ğ‘  = 0
1
ğ‘ Ã—
@I ?I
AI
@I
conditions by
(5)
(4)

â„’[ğ‘’I ğ‘¡ ] â‡’ ğ‘  R + ğ¾@I ğ‘  + ğ¾?I + ğ¾AI

0

Robotics 2

ğ¾AI

Routh criterion
8

Remarks
n

desired joint trajectory can be generated from Cartesian data
ğ‘Ìˆ, ğ‘¡ , ğ‘Ì‡, 0 , ğ‘, (0)

ğ‘Ì‡ , (0)
ğ‘Ìˆ , (ğ‘¡)

ğ‘, (0)
ğ‘Ì‡ , (ğ‘¡)

ğ‘, (ğ‘¡)

ğ‘, 0 = ğ‘“ DE ğ‘, 0
ğ‘Ì‡ , 0 = ğ½DE ğ‘, 0 ğ‘Ì‡, 0
Ì‡ , )ğ‘Ì‡ ,
ğ‘Ìˆ , ğ‘¡ = ğ½DE ğ‘, ğ‘Ìˆ, ğ‘¡ âˆ’ ğ½(ğ‘

n

8 ğ›¼ (ğ‘, ğ‘,Ì‡ ğ‘)
real-time computation by Newton-Euler algo: ğ‘¢YZ[ = ğ‘ğ¸

n

simulation of feedback linearization control
ğ‘, ğ‘¡ , ğ‘Ì‡ , ğ‘¡ ,
ğ‘Ìˆ , ğ‘¡

true parameters ğœ‹

feedback
linearization

robot

ğ‘
ğ‘Ì‡

estimated parameters ğœ‹7

Hint: there is no use in simulating this control law in ideal case (ğœ‹7 = ğœ‹ ); robot behavior
will be identical to the linear and decoupled case of stabilized double integrators!!
Robotics 2

9

Further comments
n

choice of the diagonal elements of ğ¾ğ‘ƒ, ğ¾@ (and ğ¾ğ¼ )
n

for shaping the error transients, with an eye to motor saturations...

ğ‘’(ğ‘¡) = ğ‘, (ğ‘¡) âˆ’ ğ‘(ğ‘¡)

n

parametric identification
n

n

critically damped transient

ğ‘¡

to be done in advance, using the property of linearity in the dynamic
coefficients of the robot dynamic model

choice of the sampling time of a digital implementation
n

n

ğ‘’(0)

compromise between computational time and tracking accuracy,
typically ğ‘‡c = 0.5 Ã· 10 ms

exact linearization by (state) feedback is a general technique
of nonlinear control theory
n
n

can be used for robots with elastic joints, wheeled mobile robots, ...
non-robotics applications: satellites, induction motors, helicopters, ...

Robotics 2

10

Another example of feedback linearization design
n

dynamic model of robots with elastic joints
n
n
n
n

ğ‘ = link position
2ğ‘ generalized
coordinates (ğ‘, ğœƒ)
ğœƒ = motor position (after reduction gears)
ğµh = diagonal matrix (> 0) of inertia of the (balanced) motors
ğ¾ = diagonal matrix (> 0) of (finite) stiffness of the joints

4ğ‘ state

ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘ ğ‘, ğ‘Ì‡ + ğ‘” ğ‘ + ğ¾ ğ‘ âˆ’ ğœƒ = 0
Ì‡
ğµh ğœƒÌˆ + ğ¾ ğœƒ âˆ’ ğ‘ = ğ‘¢
ğ‘¥ = (ğ‘, ğœƒ, ğ‘,Ì‡ ğœƒ)
variables

n

(1)
(2)

is there a control law that achieves exact linearization via feedback?

ğ‘¢ = ğ›¼ ğ‘, ğœƒ, ğ‘,Ì‡ ğœƒÌ‡ + ğ›½ ğ‘, ğœƒ, ğ‘,Ì‡ ğœƒÌ‡ ğ‘
linear and decoupled system:
ğ‘‘l ğ‘I
ğ‘ chains of 4 integrators
YES and it yields
= ğ‘I , ğ‘– = 1, . . , ğ‘
l
(to be stabilized by linear
ğ‘‘ğ‘¡
control design)

Hint: differentiate (1) w.r.t. time until motor acceleration ğœƒÌˆ appears;
substitute this from (2); choose ğ‘¢ so as to cancel all nonlinearities â€¦
Robotics 2

11

Alternative global trajectory controller
ğ‘¢ = ğ‘€ ğ‘ ğ‘Ìˆ , + ğ‘† ğ‘, ğ‘Ì‡ ğ‘Ì‡ , + ğ‘” ğ‘ + ğ¹o ğ‘Ì‡ , + ğ¾? ğ‘’ + ğ¾@ ğ‘’Ì‡
SPECIAL factorization such that
ğ‘€Ì‡ âˆ’ 2ğ‘† is skew-symmetric
n
n
n

global asymptotic stability of ğ‘’, ğ‘’Ì‡ = (0,0) (trajectory tracking)
proven by Lyapunov+Barbalat+LaSalle
does not produce a complete cancellation of nonlinearities
n

n

n
n

symmetric and
positive definite matrices

the ğ‘Ì‡ and ğ‘Ìˆ that appear linearly in the model are evaluated on the
desired trajectory

does not induce a linear and decoupled behavior of the
trajectory error ğ‘’ ğ‘¡ = ğ‘, (ğ‘¡) âˆ’ ğ‘(ğ‘¡) in the closed-loop system
lends itself more easily to an adaptive version
cannot be computed directly by the standard NE algorithm...

Robotics 2

12

Analysis of asymptotic stability
of the trajectory error - 1

ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘† ğ‘, ğ‘Ì‡ ğ‘Ì‡ + ğ‘” ğ‘ + ğ¹o ğ‘Ì‡ = ğ‘¢ robot dynamics (including friction)
control law ğ‘¢ = ğ‘€ ğ‘ ğ‘Ìˆ , + ğ‘† ğ‘, ğ‘Ì‡ ğ‘Ì‡ , + ğ‘” ğ‘ + ğ¹o ğ‘Ì‡ , + ğ¾? ğ‘’ + ğ¾@ ğ‘’Ì‡
n

n

Lyapunov candidate and its time derivative

1 q
1 q
1 q
Ì‡
ğ‘‰ = ğ‘’Ì‡ ğ‘€ ğ‘ ğ‘’Ì‡ + ğ‘’ ğ¾? ğ‘’ â‰¥ 0 â‡’ ğ‘‰ = ğ‘’Ì‡ ğ‘€Ì‡ ğ‘ ğ‘’Ì‡ + ğ‘’Ì‡ q ğ‘€ ğ‘ ğ‘’Ìˆ + ğ‘’ q ğ¾? ğ‘’Ì‡
2
2
2
the closed-loop system equations yield

ğ‘€ ğ‘ ğ‘’Ìˆ = âˆ’ğ‘† ğ‘, ğ‘Ì‡ ğ‘’Ì‡ âˆ’ ğ¾@ + ğ¹o ğ‘’Ì‡ âˆ’ ğ¾? ğ‘’
n

substituting and using the skew-symmetric property

ğ‘‰Ì‡ = âˆ’ğ‘’Ì‡ q ğ¾@ + ğ¹o ğ‘’Ì‡ â‰¤ 0
n

ğ‘‰Ì‡ = 0 â‡” ğ‘’Ì‡ = 0

since the system is time-varying (due to ğ‘, (ğ‘¡)), direct application
â‡’ go to
of LaSalle theorem is NOT allowed â‡’ use Barbalat lemmaâ€¦
slide 10 in

ğ‘ = ğ‘, ğ‘¡ âˆ’ ğ‘’, ğ‘Ì‡ = ğ‘Ì‡ , ğ‘¡ âˆ’ ğ‘’Ì‡ â‡’ ğ‘‰ = ğ‘‰ ğ‘’, ğ‘’,Ì‡ ğ‘¡ = ğ‘‰(ğ‘¥, ğ‘¡)
Robotics 2

error state ğ‘¥

block 8

13

Analysis of asymptotic stability
of the trajectory error - 2

n

since i) ğ‘‰ is lower bounded and ii) ğ‘‰Ì‡ â‰¤ 0, we can check condition iii)
in order to apply Barbalat lemma

ğ‘‰Ìˆ = âˆ’2ğ‘’Ì‡ q (ğ¾@ + ğ¹o )ğ‘’Ìˆ

... is this bounded?

n

from i) + ii), ğ‘‰ is bounded â‡’ ğ‘’ and ğ‘’Ì‡ are bounded

n

assume that the desired trajectory has bounded velocity ğ‘Ì‡ ,

n

using the following two properties of dynamic model terms

0 < ğ‘š â‰¤ ğ‘€DE(ğ‘) â‰¤ ğ‘€ < âˆ

â‡’

ğ‘Ì‡ is
bounded

ğ‘†(ğ‘, ğ‘)
Ì‡ â‰¤ ğ›¼v ğ‘Ì‡

then also ğ‘’Ìˆ will be bounded (in norm) since

ğ‘’Ìˆ = âˆ’ğ‘€DE (ğ‘) ğ‘† ğ‘, ğ‘Ì‡ ğ‘’Ì‡ + ğ¾? ğ‘’ + (ğ¾@ + ğ¹o )ğ‘’Ì‡
bounded
in norm by ğ‘€

bounded bounded

bounded
in norm by ğ›¼v ğ‘Ì‡

Robotics 2

bounded

lim ğ‘‰Ì‡ ğ‘¡ = 0
â‡’ zâ†’{

bounded

14

Analysis of asymptotic stability
of the trajectory error â€“ end of proof

n

we can now conclude by proceeding as in LaSalle theorem

ğ‘‰Ì‡ = 0 â‡” ğ‘’Ì‡ = 0
n

the closed-loop dynamics in this situation is

ğ‘€ ğ‘ ğ‘’Ìˆ = âˆ’ğ¾? ğ‘’
âŸ¹

ğ‘’Ìˆ = 0 â‡” ğ‘’ = 0

(ğ‘’, ğ‘’)Ì‡ = (0, 0)
is the largest
invariant set in ğ‘‰Ì‡ = 0
(global) asymptotic tracking
will be achieved

Robotics 2

15

Regulation as a special case
n

n

what happens to the control laws designed for trajectory
tracking when ğ‘ğ‘‘ is constant? are there simplifications?
feedback linearization

ğ‘¢ = ğ‘€ ğ‘ ğ¾? ğ‘, âˆ’ ğ‘ âˆ’ ğ¾@ ğ‘Ì‡ + ğ‘ ğ‘, ğ‘Ì‡ + ğ‘”(ğ‘)
n
n

n

no special simplifications
however, this is a solution to the regulation problem with
exponential stability (and decoupled transients at each joint!)

alternative global controller

ğ‘¢ = ğ¾? (ğ‘, âˆ’ ğ‘) âˆ’ ğ¾@ ğ‘Ì‡ + ğ‘” ğ‘
n

Robotics 2

we recover the PD + gravity cancellation control law!!

16

Trajectory execution without a model
n

n

is it possible to accurately reproduce a desired smooth jointspace reference trajectory with reduced or no information on
the robot dynamic model?
this is feasible in case of repetitive motion tasks over a finite
interval of time
n

n

n

n

trials are performed iteratively, storing the trajectory error
information of the current execution [ğ‘˜-th iteration] and
processing it off line before the next trial [(ğ‘˜ + 1)-iteration] starts
the robot should be reinitialized in the same initial position at the
beginning of each trial
the control law is made of a non-model based part (typically, a
decentralized PD law) + a time-varying feedforward which is
updated at every trial

this scheme is called iterative trajectory learning

Robotics 2

17

Scheme of iterative trajectory learning
n

control design can be illustrated on a SISO linear system
in the Laplace domain
â€œplug-inâ€ signal:
ğ‘£E (ğ‘¡) â‰¡ 0 at
first (ğ‘˜ = 1) iteration
ğ‘ª(ğ’”)

ğ‘¦(ğ‘ )
ğ‘ƒ ğ‘  ğ¶(ğ‘ )
ğ‘Š ğ‘  =
=
ğ‘¦, (ğ‘ ) 1 + ğ‘ƒ ğ‘  ğ¶(ğ‘ )

ğ‘·(ğ’”)

closed-loop system without learning
(ğ¶(ğ‘ ) is, e.g., a PD control law)

ğ‘¢â€ ğ‘  = ğ‘¢â€â€¦ ğ‘  + ğ‘£â€ ğ‘  = ğ¶ ğ‘  ğ‘’â€ ğ‘  + ğ‘£â€ ğ‘  control law at iteration ğ‘˜
ğ‘ƒ(ğ‘ )
ğ‘¦â€ ğ‘  = ğ‘Š ğ‘  ğ‘¦, ğ‘  +
ğ‘£â€ ğ‘ 
1 + ğ‘ƒ ğ‘  ğ¶(ğ‘ )
Robotics 2

system output at iteration ğ‘˜
18

Background math on feedback loops
whiteboardâ€¦

n

algebraic manipulations on block diagram signals in the Laplace domain:
ğ‘¥ ğ‘  = â„’ ğ‘¥(ğ‘¡) , ğ‘¥ = ğ‘¦, , ğ‘¦, ğ‘¢ â€¦ , ğ‘£, ğ‘’ â‡’ ğ‘¦, , ğ‘¦â€ , ğ‘¢â€â€¦ , ğ‘£â€ , ğ‘’â€ , with transfer functions
ğ‘¦ ğ‘  = ğ‘ƒ ğ‘  ğ‘¢ ğ‘  = ğ‘ƒ ğ‘  ğ‘£ ğ‘  + ğ‘¢â€¦ ğ‘ 
=ğ‘ƒ ğ‘  ğ‘£ ğ‘  +ğ‘ƒ ğ‘  ğ¶ ğ‘  ğ‘’ ğ‘ 
= ğ‘ƒ ğ‘  ğ‘£ ğ‘  + ğ‘ƒ ğ‘  ğ¶ ğ‘  ğ‘¦, ğ‘  âˆ’ ğ‘¦(ğ‘ )

ğ‘ª(ğ’”)

â‡’

ğ‘¦ ğ‘  =

â‡’ (1 + ğ‘ƒ ğ‘  ğ¶ ğ‘  ) ğ‘¦ ğ‘  =

ğ‘·(ğ’”)

= ğ‘ƒ ğ‘  ğ‘£ ğ‘  + ğ‘ƒ ğ‘  ğ¶ ğ‘  ğ‘¦, ğ‘ 

ğ‘ƒ ğ‘  ğ¶ ğ‘ 
ğ‘ƒ ğ‘ 
ğ‘¦, ğ‘  +
ğ‘£ ğ‘  = ğ‘Š ğ‘  ğ‘¦, ğ‘  + ğ‘ŠË† ğ‘  ğ‘£(ğ‘ )
1+ğ‘ƒ ğ‘  ğ¶ ğ‘ 
1+ğ‘ƒ ğ‘  ğ¶ ğ‘ 

Â§ feedback control law at iteration ğ‘˜
ğ‘¢â€â€¦ ğ‘  = ğ¶ ğ‘  ğ‘¦, ğ‘  âˆ’ ğ‘¦â€ ğ‘ 

â‡’

= ğ¶ ğ‘  ğ‘¦, ğ‘  âˆ’ ğ‘ƒ ğ‘  ğ¶(ğ‘ ) ğ‘£â€ ğ‘  + ğ‘¢â€â€¦ ğ‘ 
ğ¶ ğ‘ 
ğ‘ƒ ğ‘  ğ¶ ğ‘ 
â€¦
ğ‘¢â€ ğ‘  =
ğ‘¦ ğ‘  âˆ’
ğ‘£ ğ‘  = ğ‘Šc ğ‘  ğ‘¦, ğ‘  âˆ’ ğ‘Š ğ‘  ğ‘£â€ ğ‘ 
1+ğ‘ƒ ğ‘  ğ¶ ğ‘  ,
1+ğ‘ƒ ğ‘  ğ¶ ğ‘  â€

Â§ error at iteration ğ‘˜
ğ‘’â€ ğ‘  = ğ‘¦, ğ‘  âˆ’ ğ‘¦â€ ğ‘  = ğ‘¦, ğ‘  âˆ’ ğ‘Š ğ‘  ğ‘¦, ğ‘  + ğ‘ŠË† ğ‘  ğ‘£â€ ğ‘ 
Robotics 2

= 1 âˆ’ ğ‘Š ğ‘  ğ‘¦, ğ‘  âˆ’ ğ‘ŠË† ğ‘  ğ‘£â€ ğ‘ 

ğ‘Šâ€° (ğ‘ ) = 1/(1 + ğ‘ƒ ğ‘  ğ¶ ğ‘  )

19

Learning update law
n

the update of the feedforward term is designed as

ğ‘£â€â€¹E ğ‘  = ğ›¼(ğ‘ )ğ‘¢â€â€¦ ğ‘  + ğ›½(ğ‘ )ğ‘£â€ ğ‘ 

with ğ›¼ and ğ›½ suitable filters
(also non-causal, of the FIR type)

ğ›¼ ğ‘  ğ¶ ğ‘ 
recursive expression
ğ‘£â€â€¹E ğ‘  =
ğ‘¦, ğ‘  + (ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘  )ğ‘£â€ (ğ‘ )
of feedforward term
1+ğ‘ƒ ğ‘  ğ¶ ğ‘ 
1âˆ’ğ›½ ğ‘ 
recursive expression
ğ‘’
ğ‘  =
ğ‘¦, ğ‘  + ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘  ğ‘’â€ (ğ‘ )
of error ğ‘’ = ğ‘¦, âˆ’ ğ‘¦ â€â€¹E
1+ğ‘ƒ ğ‘  ğ¶ ğ‘ 
n

if a contraction condition can be enforced
ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š(ğ‘ ) < 1 (for all ğ‘  = ğ‘—ğœ” frequencies such that ...)
then convergence is obtained for ğ‘˜ â†’ âˆ

ğ‘£{

ğ‘¦, ğ‘ 
ğ›¼ ğ‘  ğ‘Š ğ‘ 
ğ‘  =
ğ‘ƒ(ğ‘ ) 1 âˆ’ ğ›½ ğ‘  + ğ›¼ ğ‘  ğ‘Š ğ‘ 

Robotics 2

ğ‘’{

ğ‘¦, ğ‘ 
1âˆ’ğ›½ ğ‘ 
ğ‘  =
1 + ğ‘ƒ ğ‘  ğ¶(ğ‘ ) 1 âˆ’ ğ›½ ğ‘  + ğ›¼ ğ‘  ğ‘Š ğ‘ 
20

Proof of recursive updates
whiteboardâ€¦

Â§ recursive expression for the feedworward ğ‘£â€
ğ‘£â€â€¹E ğ‘  = ğ›¼ ğ‘  ğ‘¢â€â€¦ ğ‘  + ğ›½ ğ‘  ğ‘£â€ ğ‘  = ğ›¼ ğ‘  ğ¶ ğ‘  ğ‘’â€ ğ‘  + ğ›½ ğ‘  ğ‘£â€ ğ‘ 
= ğ›¼ ğ‘  ğ¶ ğ‘  ğ‘Šâ€° (ğ‘ )ğ‘¦, ğ‘  âˆ’ ğ‘ŠË† ğ‘  ğ‘£â€ ğ‘  + ğ›½ ğ‘  ğ‘£â€ ğ‘ 
ğ›¼ ğ‘  ğ¶ ğ‘ 
=
ğ‘¦ ğ‘  + (ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘  ) ğ‘£â€ (ğ‘ )
1+ğ‘ƒ ğ‘  ğ¶ ğ‘  ,
Â§ recursive expression for the error ğ‘’â€
ğ‘’â€ ğ‘  = ğ‘¦, ğ‘  âˆ’ ğ‘¦â€ ğ‘  = ğ‘¦, ğ‘  âˆ’ ğ‘ƒ(ğ‘ )(ğ‘£â€ ğ‘  + ğ‘¢â€â€¦ ğ‘  )
1
ğ‘¦, ğ‘  âˆ’ ğ‘’â€ ğ‘  âˆ’ ğ‘¢â€â€¦ ğ‘ 
â‡’ ğ‘£â€ ğ‘  =
ğ‘ƒ ğ‘ 
â€¦
ğ‘¦â€â€¹E ğ‘  = ğ‘ƒ ğ‘  ğ‘£â€â€¹E ğ‘  + ğ‘¢â€â€¹E
ğ‘ 

ğ‘’â€â€¹E

â€¦
= ğ‘ƒ ğ‘  ğ›¼ ğ‘  ğ‘¢â€â€¦ ğ‘  + ğ›½ ğ‘  ğ‘£â€ ğ‘  + ğ‘¢â€â€¹E
ğ‘ 
1
= ğ‘ƒ ğ‘  ğ›¼ ğ‘  ğ¶ ğ‘  ğ‘’â€ ğ‘  + ğ›½ ğ‘ 
ğ‘¦ ğ‘  âˆ’ ğ‘’â€ ğ‘  âˆ’ ğ›½ ğ‘  ğ¶ ğ‘  ğ‘’â€ ğ‘  + ğ¶ ğ‘  ğ‘’â€â€¹E (ğ‘ )
ğ‘ƒ(ğ‘ ) ,
ğ‘  = ğ‘¦, ğ‘  âˆ’ ğ‘¦â€â€¹E ğ‘ 

= (1 âˆ’ ğ›½ ğ‘  ) ğ‘¦, ğ‘  âˆ’

â‡’ ğ‘’â€â€¹E
Robotics 2

ğ›¼ ğ‘  âˆ’ ğ›½ ğ‘  ğ‘ƒ ğ‘  ğ¶ ğ‘  âˆ’ ğ›½ ğ‘  ğ‘’â€ ğ‘  âˆ’ ğ‘ƒ ğ‘  ğ¶(ğ‘ )ğ‘’â€â€¹E ğ‘ 

1âˆ’ğ›½ ğ‘ 
ğ‘  =
ğ‘¦ ğ‘  + ğ›½ ğ‘  âˆ’ğ›¼ ğ‘  ğ‘Š ğ‘ 
1+ğ‘ƒ ğ‘  ğ¶ ğ‘  ,

ğ‘’â€ (ğ‘ )
21

Proof of convergence
whiteboardâ€¦

from recursive expressions
ğ›¼ ğ‘  ğ¶ ğ‘ 
ğ‘£â€â€¹E ğ‘  =
ğ‘¦ ğ‘  + (ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘  ) ğ‘£â€ (ğ‘ )
1+ğ‘ƒ ğ‘  ğ¶ ğ‘  ,
1âˆ’ğ›½ ğ‘ 
ğ‘’â€â€¹E ğ‘  =
ğ‘¦, ğ‘  + ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘  ğ‘’â€ (ğ‘ )
1+ğ‘ƒ ğ‘  ğ¶ ğ‘ 
compute variations from ğ‘˜ to ğ‘˜ + 1 (repetitive term in trajectory ğ‘¦, vanishes!)
âˆ†ğ‘£â€â€¹E ğ‘  = ğ‘£â€â€¹E ğ‘  âˆ’ ğ‘£â€ ğ‘  = (ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘  ) âˆ†ğ‘£â€ (ğ‘ )
âˆ†ğ‘’â€â€¹E ğ‘  = ğ‘’â€â€¹E ğ‘  âˆ’ ğ‘’â€ ğ‘  = ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘ 

âˆ†ğ‘’â€ (ğ‘ )

by contraction mapping condition ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘  < 1 â‡’ ğ‘£â€ â†’ ğ‘£{ , ğ‘’â€ â†’ ğ‘’{
ğ›¼ ğ‘  ğ¶ ğ‘ 
ğ‘£{ ğ‘  =
ğ‘¦ ğ‘  + (ğ›½ ğ‘  âˆ’ ğ›¼ ğ‘  ğ‘Š ğ‘  ) ğ‘£{ (ğ‘ )
1+ğ‘ƒ ğ‘  ğ¶ ğ‘  ,
ğ‘’{

â‡’

ğ‘£{

Robotics 2

1âˆ’ğ›½ ğ‘ 
ğ‘  =
ğ‘¦ ğ‘  + ğ›½ ğ‘  âˆ’ğ›¼ ğ‘  ğ‘Š ğ‘ 
1+ğ‘ƒ ğ‘  ğ¶ ğ‘  ,

ğ‘¦, ğ‘ 
ğ›¼ ğ‘  ğ‘Š ğ‘ 
ğ‘  =
ğ‘ƒ(ğ‘ ) 1 âˆ’ ğ›½ ğ‘  + ğ›¼ ğ‘  ğ‘Š ğ‘ 

ğ‘’{

ğ‘’{ (ğ‘ )

ğ‘¦, ğ‘ 
1âˆ’ğ›½ ğ‘ 
ğ‘  =
1 + ğ‘ƒ ğ‘  ğ¶(ğ‘ ) 1 âˆ’ ğ›½ ğ‘  + ğ›¼ ğ‘  ğ‘Š ğ‘ 
22

Comments on convergence
n

if the choice ğ›½ = 1 allows to satisfy the contraction condition, then
convergence to zero tracking error is obtained

ğ‘’{(ğ‘ ) = 0
and the inverse dynamics command has been learned

ğ‘¦, (ğ‘ )
ğ‘£{(ğ‘ ) =
ğ‘(ğ‘ )
n
n

n

in particular, for

Î± ğ‘  = 1/ğ‘¤(ğ‘ ) convergence would be in 1 iteration only!

the use of filter Î²(ğ‘ ) â‰  1 allows to obtain convergence (but with residual
tracking error) even in presence of unmodeled high-frequency dynamics
the two filters can be designed from very poor
information on system dynamics, using classic
tools (e.g., Nyquist plots)

Robotics 2

23

Application to robots
n

for ğ‘-dof robots modeled as

ğµh + ğ‘€(ğ‘) ğ‘Ìˆ + ğ¹o + ğ‘†(ğ‘, ğ‘)
Ì‡ ğ‘Ì‡ + ğ‘” ğ‘ = ğ‘¢
we choose as (initial = pre-learning) control law

ğ‘¢ = ğ‘¢â€¦ = ğ¾? ğ‘, âˆ’ ğ‘ + ğ¾@ ğ‘Ì‡ , âˆ’ ğ‘Ì‡ + ğ‘”7 ğ‘
and design the learning filters (at each joint) using
the linear approximation
ğ‘I (ğ‘ )
ğ¾@I ğ‘  + ğ¾?I
ğ‘– = 1, â‹¯ , ğ‘
ğ‘ŠI ğ‘  =
=
R
ğ‘,I (ğ‘ ) ğµâ€œh ğ‘  + ğ¹â€œoI + ğ¾@I ğ‘  + ğ¾?I
n

initialization of feedforward uses the best estimates
6 , ) ğ‘Ìˆ , + ğ¹â€œo + ğ‘†(ğ‘
â€ , , ğ‘Ì‡ , ) ğ‘Ì‡ , + ğ‘”7 ğ‘,
ğ‘£E = ğµâ€œh + ğ‘€(ğ‘
or simply ğ‘£E = 0 (in the worst case) at first trial ğ‘˜ = 1

Robotics 2

24

Experimental set-up
n

joints 2 and 3 of 6R MIMO CRF robot prototype @DIS

â‰ˆ 90% gravity
balanced
through springs

160o
50o/s

high level of
dry friction
Harmonic Drives
transmissions
with ratio 160:1

desired velocity/position for both joints

DC motors with
current amplifiers

DSP ğ‘‡ğ‘ = 400Âµs
D/A = 12 bit
R/D = 16 bit/2ğœ‹
A/D = 11 bit/(rad/s)

Robotics 2

resolvers and
tachometers

De Luca, Paesano, Ulivi: IEEE Trans Ind Elect, 1992

25

Experimental results

Robotics 2

feedforward ğ‘£ğ‘˜ for ğ‘˜ = 3, 6, 12 (zero at ğ‘˜ = 1)

feedback ğ‘¢â€â€¦ for ğ‘˜ = 1, 3, 6, 12

joint 3

joint 2

error for ğ‘˜ = 1, 3, 6, 12

26

