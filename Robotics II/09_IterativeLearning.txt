Robotics 2

Iterative Learning
for Gravity Compensation
Prof. Alessandro De Luca

Control goal
n

regulation of arbitrary equilibrium configurations in the
presence of gravity
n

n

without explicit knowledge of robot dynamic coefficients (nor of
the structure of the gravity term)

n

without the need of â€œhighâ€ position gain

n

without complex conditions on the control gains

based on an iterative control scheme that uses
1. PD control on joint position error + constant feedforward term
2. iterative update of the feedforward term at successive steadystate conditions

n

derive sufficient conditions for the global convergence
of the iterative scheme with zero final error

Robotics 2

2

Preliminaries
n

robot dynamic model

ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘ ğ‘, ğ‘Ì‡ + ğ‘” ğ‘ = ğ‘¢
n

available bound on the gradient of the gravity term

ğœ•ğ‘”(ğ‘)
â‰¤ğ›¼
ğœ•ğ‘
n

regulation attempted with a joint-based PD law
(without gravity cancellation nor compensation)

ğ‘¢ = ğ¾1 ğ‘2 âˆ’ ğ‘ âˆ’ ğ¾4 ğ‘Ì‡
n

at steady state, there is a non-zero error left

ğ‘ = ğ‘7 , ğ‘Ì‡ = 0
Robotics 2

ğ¾1 > 0, ğ¾4 > 0

ğ‘”(7
ğ‘) = ğ¾1 ğ‘2 âˆ’ ğ‘7

ğ‘’Ì… = ğ‘2 âˆ’ ğ‘7 â‰  0
3

Iterative control scheme
n

control law at the ğ‘– -th iteration (for ğ‘– = 1, 2, â€¦)

ğ‘¢ = ğ›¾ğ¾1 ğ‘2 âˆ’ ğ‘ âˆ’ ğ¾4 ğ‘Ì‡ + ğ‘¢?@A

ğ›¾>0

with a constant compensation term ğ‘¢?@A (feedforward)
n
n
n
n

ğ¾1 > 0, ğ¾4 > 0 are chosen diagonal for simplicity
ğ‘B is the initial robot configuration
ğ‘¢B = 0 is the â€˜easiestâ€™ initialization of the feedforward term
at the steady state of the ğ‘– -th iteration (ğ‘ = ğ‘? , ğ‘Ì‡ = 0), one has

ğ‘”(ğ‘? ) = ğ›¾ğ¾1 ğ‘2 âˆ’ ğ‘? + ğ‘¢?@A
n

update law of the compensation term (for next iteration)

ğ‘¢? = ğ›¾ğ¾1 ğ‘2 âˆ’ ğ‘? + ğ‘¢?@A
â† for implementation â†’
Robotics 2

= ğ‘”(ğ‘? )
[ for analysis ]
4

Convergence analysis
Theorem

(a) ğœ†IJK ğ¾1 > ğ›¼

(b) ğ›¾ â‰¥ 2
guarantee that the sequence {ğ‘B , ğ‘A , ğ‘E , â€¦ } converges to ğ‘ğ‘‘
(and ğ‘Ì‡ = 0) from any initial value ğ‘B (and ğ‘Ì‡ B ), i.e., globally
n

condition (a) is sufficient for the global asymptotic stability
of the desired equilibrium state when using

ğ‘¢ = ğ¾1 ğ‘2 âˆ’ ğ‘ âˆ’ ğ¾4 ğ‘Ì‡ + ğ‘”(ğ‘2 )

n

with a known gravity term and diagonal gain matrices
the additional sufficient condition (b) guarantees the
convergence of the iterative scheme, yielding

lim ğ‘¢? = ğ‘”(ğ‘2 )

Robotics 2

?â†’Q

5

Proof
n

let ğ‘’? = ğ‘2 âˆ’ ğ‘? be the error at the end of the ğ‘– -th iteration;
based on the update law, it is ğ‘¢? = ğ‘”(ğ‘? ) and thus

ğ‘¢? âˆ’ ğ‘¢?@A = ğ‘”(ğ‘? ) âˆ’ ğ‘”(ğ‘?@A ) â‰¤ ğ›¼ ğ‘? âˆ’ ğ‘?@A
â‰¤ ğ›¼ ğ‘’? + ğ‘’?@A
n

on the other hand, from the update law it is

ğ‘¢? âˆ’ ğ‘¢?@A = ğ›¾ ğ¾1 ğ‘’?
n

combining the two above relations under (a), we have

ğ›¾ğ›¼ ğ‘’? < ğ›¾ğœ†IJK ğ¾1
or
Robotics 2

ğ‘’?

ğ‘’? â‰¤ ğ›¾ ğ¾1 ğ‘’? â‰¤ ğ›¼ ğ‘’? + ğ‘’?@A
1
<
ğ›¾

ğ‘’? + ğ‘’?@A
6

Proof
n

(cont)

condition (b) guarantees that the error sequence {ğ‘’B , ğ‘’A , ğ‘’E , â€¦ }

ğ‘’? <

A
T

1âˆ’

A
T

ğ‘’?@A

1
=
ğ‘’?@A
ğ›¾âˆ’1

is a contraction mapping, so that

lim ğ‘’? = 0

?â†’Q

with asymptotic convergence from any initial state

â‡’ the robot progressively approaches the desired configuration
through successive steady-state conditions
n ğ¾1 and ğ¾4 affect each transient phase
n coefficient ğ›¾ drives the convergence rate of intermediate steady states
to the final one
Robotics 2

7

Remarks
n

combining (a) and (b), the sufficient condition only requires the
doubling of the proportional gain w.r.t. the known gravity case

U1 = ğ›¾ğ¾1
ğ¾

U1 > 2ğ›¼
ğœ†IJK ğ¾

n

U1 , this condition implies a (positive) lower bound
for a diagonal ğ¾
on the single diagonal elements of the matrix

n

again, it is only a sufficient condition
n

n

the scheme may converge even if this condition is violated ...

the scheme can be interpreted as using an integral term
n

n

updated only in correspondence of a discrete sequence of time
instants
with guaranteed global convergence (and implicit stability)

Robotics 2

8

Numerical results
n

n

n

3R robot with uniform links, moving in the vertical plane
ğ‘™A = ğ‘™E = ğ‘™[ = 0.5 [m]
ğ‘šA = 30, ğ‘šE = 20, ğ‘š[ = 10 [kg]
ğ›¼ â‰… 400
with saturations of the actuating torques
ğ‘ˆA,Iab = 800, ğ‘ˆE,Iab = 400, ğ‘ˆ[,Iab = 200 [Nm]
three cases, from the downward position ğ‘B = (0, 0, 0)
I: ğ‘2 = (ğœ‹/2, 0, 0)
II: ğ‘2 = (3ğœ‹/4, 0, 0)
III: ğ‘2 = (3ğœ‹/4, 0, 0)

Robotics 2

U1 = diag 1000, 600, 280
ğ¾
ğ¾4 = diag 200, 100, 20
U1 = diag 500, 500, 500
ğ¾
ğ¾4 = as before
9

Case I: ğ‘2 = (ğœ‹/2, 0, 0)

joint position errors (zero after 3 updates)

Robotics 2

control torques

10

Case II: ğ‘2 = (3ğœ‹/4, 0, 0)

joint position errors (zero after 5 updates)

Robotics 2

control torques

11

Case III: ğ‘2 = (3ğœ‹/4, 0, 0), reduced gains

joint position errors (limit cycles, no convergence!)

Robotics 2

control torques

12

Final comments
n

n

only few iterations are needed for obtaining convergence,
learning the correct gravity compensation at the desired ğ‘ğ‘‘

sufficiency of the condition on the ğ‘ƒ gain
n

n

n

n

even if violated, convergence can still be obtained (first two cases);
otherwise, a limit motion cycle takes place between two equilibrium
configurations that are both incorrect (as in the third case)
this shows how â€˜distantâ€™ is sufficiency from necessity

analysis can be refined to get lower bounds on the ğ¾ğ‘ƒğ‘– (diagonal
case) that are smaller, but still sufficient for convergence
n intuitively, lower values for ğ¾ğ‘ƒğ‘– should be sufficient for distal joints
in practice, update of the feedforward term occurs when the
robot is close enough to a steady state (joint velocities and
position variations are below suitable thresholds)

Robotics 2

13

Control experiments with flexible robots
without gravity

video

rest-to-rest maneuver in given motion time
for a single flexible link (PD + feedforward)

video

end-effector trajectory tracking for FlexArm
â€”a planar 2R robot with flexible forearm
Robotics 2

14

Extension to flexible robots
n

the same iterative learning control approach has been extended to
position regulation in robots with flexible joints and/or links under gravity
n
n

n

at the motor/joint level
at the Cartesian level (end-effector tip position, beyond flexibility), using a
double iterative scheme

experimentally validated on the Two-link FlexArm @ DIS (now DIAG!)

6Â° tilt
from horizontal

âˆ†

with supporting base
tilted by approx âˆ† = 6Â°
(inclusion of gravity)
Robotics 2

15

Experimental results for tip regulation
3 iterations!

0g

sin âˆ†

motion task:
o
o
o
(0 ,0 ) â‡’ (90 ,0 )
o

first link position

tip angle w.r.t. first link

final deflection

double iterative scheme
De Luca, Panzieri: Int J Adapt Cont & Sign Proc, 1996
(factor ğ›¾ â†’ 1â„ğ›½ in the original paper)
Robotics 2

second link deflection
16

