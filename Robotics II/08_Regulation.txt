Robotics 2

Position Regulation
(with an introduction to stability)
Prof. Alessandro De Luca

Equilibrium states of a robot
ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘ ğ‘, ğ‘Ì‡ + ğ‘” ğ‘ = ğ‘¢

ğ‘
ğ‘¥#
ğ‘¥ = ğ‘¥ = ğ‘Ì‡
$

ğ‘¥$
ğ‘¥Ì‡ #
ğ‘¥Ì‡ =
= âˆ’ğ‘€/# (ğ‘¥ ) ğ‘ ğ‘¥ , ğ‘¥ + ğ‘”(ğ‘¥ )
ğ‘¥Ì‡ $
#
# $
#

0
+
ğ‘¢
ğ‘€/# (ğ‘¥# )

= ğ‘“ ğ‘¥ + ğº ğ‘¥# ğ‘¢
ğ‘¥5 unforced equilibrium

(ğ‘¢ = 0)

ğ‘¥5 forced equilibrium

(ğ‘¢ = ğ‘¢(ğ‘¥))

ğ‘“ ğ‘¥5 = 0
ğ‘“ ğ‘¥5 + ğº ğ‘¥5,$ ğ‘¢(ğ‘¥5 ) = 0

all equilibrium states of mechanical
systems have zero velocity!
Robotics 2

ğ‘¥5,$ = 0
ğ‘” ğ‘¥5,# = 0
ğ‘¥5,$ = 0
ğ‘¢ ğ‘¥5 = ğ‘” ğ‘¥5,#

joint torques must balance gravity
at the equilibrium!
2

Stability of dynamical systems
definitions - 1

ğ‘¥Ì‡ = ğ‘“(ğ‘¥)

e.g., a closed-loop system
(under feedback control)

ğ‘¥5 equilibrium: ğ‘“(ğ‘¥5 ) = 0

(sometimes we consider as equilibrium state
ğ‘¥5 = 0, e.g., when using errors as variables)

stability of ğ‘¥5
âˆ€ğœ€ > 0, âˆƒğ›¿; > 0: ğ‘¥ ğ‘¡> âˆ’ ğ‘¥5 < ğ›¿; âŸ¹ ğ‘¥ ğ‘¡ âˆ’ ğ‘¥5 < ğœ€, âˆ€ğ‘¡ â‰¥ ğ‘¡>
asymptotic stability of ğ‘¥5

stability +

âˆƒğ›¿ > 0: ğ‘¥ ğ‘¡> âˆ’ ğ‘¥5 < ğ›¿ âŸ¹ ğ‘¥ ğ‘¡ âˆ’ ğ‘¥5 â†’ 0, for ğ‘¡ â†’ âˆ
asymptotic stability may become global (âˆ€ğ›¿ > 0, finite)
note: these are definitions of stability â€œin the sense of Lyapunovâ€
Robotics 2

3

Stability vs. asymptotic stability
whiteboardâ€¦

ğ‘¥5

ğ›¿;

ğœ€

ğ‘¥5

ğ‘¥5

ğ‘¥5
ğ‘¥(ğ‘¡> )

âˆ€ğœ€ > 0

âˆƒğ›¿; > 0

ğ‘¥ ğ‘¡> âˆ’ ğ‘¥5 < ğ›¿;

ğ‘¥(ğ‘¡> )

âŸ¹ ğ‘¥ ğ‘¡ âˆ’ ğ‘¥5 < ğœ€, âˆ€ğ‘¡ â‰¥ ğ‘¡>

equilibrium state ğ‘¥5 is stable

+

ğ‘¥5
ğ›¿

âˆƒğ›¿ > 0
Robotics 2

ğ‘¥5
ğ‘¥(ğ‘¡> )

ğ‘¥ ğ‘¡> âˆ’ ğ‘¥5 < ğ›¿

ğ‘¥5
ğ‘¥(ğ‘¡> )

âŸ¹ ğ‘¥ ğ‘¡ âˆ’ ğ‘¥5 â†’ 0, for ğ‘¡ â†’ âˆ

equilibrium state ğ‘¥5 is asymptotically stable

4

Stability of dynamical systems
definitions - 2

exponential stability of ğ‘¥5

exponential rate ğœ†

âˆƒğ›¿, ğ‘, ğœ† > 0: ğ‘¥ ğ‘¡> âˆ’ ğ‘¥5 < ğ›¿ âŸ¹ ğ‘¥ ğ‘¡ âˆ’ ğ‘¥5 â‰¤ ğ‘ğ‘’ /M N/NO ğ‘¥ ğ‘¡> âˆ’ ğ‘¥5
Â§ allows to estimate the time needed to â€approximatelyâ€ converge: for ğ‘ = 1,
in ğ‘¡ âˆ’ ğ‘¡> = 3 Ã— the time constant ğœ = 1/ğœ†, the initial error is reduced to 5%
Â§ typically, this is a local property only (within some maximum finite radius ğ›¿ )
â‡’ such â€œdomain of attractionâ€ is hard to be estimated accurately

â€œpracticalâ€ stability of a set ğ‘†
âˆƒğ‘‡ ğ‘¥ ğ‘¡> , ğ‘† âˆˆ â„: ğ‘¥ ğ‘¡ âˆˆ ğ‘†, âˆ€ğ‘¡ â‰¥ ğ‘¡> + ğ‘‡ ğ‘¥ ğ‘¡> , ğ‘†
a finite time

also known as u.u.b. stability
â‡’ trajectories ğ‘¥(ğ‘¡) are â€œultimately uniformly boundedâ€ (use in robust control)
Robotics 2

5

The need for analysis and criteria
whiteboardâ€¦

a nonlinear system ğ‘¥Ì‡ = ğ‘“ ğ‘¥ in â„$

ğ‘¥Ì‡ # = 1 âˆ’ ğ‘¥#U
T
ğ‘¥Ì‡ $ = ğ‘¥# âˆ’ ğ‘¥$$

two equilibria ğ‘“ ğ‘¥5 = 0

ğ‘¥5V = 1, 1 , ğ‘¥5VV = 1, âˆ’1

to assess (asymptotic) stability [or not]
of equilibria, do we need to compute
all system trajectories, starting from all
possible initial states ğ‘¥(ğ‘¡> )?

1.5

1

0.5

x2

rather, we may be able to just look at
the time evolution of a scalar function ğ‘‰,
evaluated analytically along the state
trajectories of the system (even in â„X !)
Robotics 2

asymptotically stable ğ‘¥5V

ğ‘¥(ğ‘¡> )

0

-0.5

ğ‘¥(ğ‘¡> )

-1

-1.5
-1

unstable ğ‘¥5VV
-0.5

0

0.5

1

1.5

x1

6

Stability of dynamical systems
results - 1

Lyapunov candidate ğ‘‰ ğ‘¥ : â„X âŸ¶ â„ such that
ğ‘‰ ğ‘¥5 = 0, ğ‘‰ ğ‘¥ > 0, âˆ€ğ‘¥ â‰  ğ‘¥5

positive
definite
function

#

typically quadratic (e.g., (ğ‘¥ âˆ’ ğ‘¥5 )Y ğ‘ƒ(ğ‘¥ âˆ’ ğ‘¥5 ) with level surfaces = ellipsoids)
$

may also be a local candidate only (âˆ€ğ‘¥ â‰  ğ‘¥5 : ğ‘¥ âˆ’ ğ‘¥5 < ğ›¿)
sufficient condition of stability

Ì‡
âˆƒğ‘‰ candidate: ğ‘‰(ğ‘¥)
â‰¤ 0, along the trajectories of ğ‘¥Ì‡ = ğ‘“(ğ‘¥)
sufficient condition of asymptotic stability

âˆƒğ‘‰ candidate: ğ‘‰Ì‡ ğ‘¥ < 0, along the trajectories of ğ‘¥Ì‡ = ğ‘“(ğ‘¥)

negative
semi-definite
function
negative
definite
function

sufficient condition of instability

âˆƒğ‘‰ candidate: ğ‘‰Ì‡ ğ‘¥ > 0, along the trajectories of ğ‘¥Ì‡ = ğ‘“(ğ‘¥)
Robotics 2

7

Stability of dynamical systems
results - 2

sufficient condition of u.u.b. stability of a set ğ‘†

âˆƒğ‘‰ candidate: i) ğ‘† is a level set of ğ‘‰ for a given ğ‘>

ğ‘† = ğ‘† ğ‘> = ğ‘¥ âˆˆ â„X : ğ‘‰(ğ‘¥) â‰¤ ğ‘>

ii) ğ‘‰Ì‡ ğ‘¥ < 0 along trajectories of ğ‘¥Ì‡ = ğ‘“ ğ‘¥ , ğ‘¥ âˆ‰ ğ‘†
LaSalle Theorem
if âˆƒğ‘‰ candidate: ğ‘‰Ì‡ ğ‘¥ â‰¤ 0 along the trajectories of ğ‘¥Ì‡ = ğ‘“(ğ‘¥)
then system trajectories asymptotically converge to the

Ì‡
largest invariant set â„³ âŠ† ğ‘† = ğ‘¥ âˆˆ â„X : ğ‘‰(ğ‘¥)
=0
â„³ is invariant if ğ‘¥ ğ‘¡> âˆˆ â„³ âŸ¹ ğ‘¥ ğ‘¡ âˆˆ â„³, âˆ€ğ‘¡ â‰¥ ğ‘¡>
Corollary

â„³ â‰¡ ğ‘¥5
Robotics 2

asymptotic stability
8

Bird-eye view on Lyapunov analysis
whiteboardâ€¦

a mass ğ‘š at the end of an unforced (passive) pendulum of length ğ‘™
ğ‘¥Ì‡ # = ğ‘¥$
ğ‘¥ = ğ‘¥# , ğ‘¥$
ğ‘šğ‘™ $ ğœƒÌˆ + ğ‘ ğœƒÌ‡ + ğ‘šğ‘™ğ‘”> sin ğœƒ = 0

â‡’

lower equilibrium at ğœƒ5 = 0

â‡’

Ì‡ âˆˆ â„$
= (ğœƒ, ğœƒ)

ğ‘”>
ğ‘
ğ‘¥Ì‡ $ = âˆ’
sin ğ‘¥# âˆ’
ğ‘¥
ğ‘™
ğ‘šğ‘™ $ $

4
3

3
2

2

ğ‘¥5 = ğŸ

dtheta

dtheta

phase
plane

1

1

0

-1

ğ‘¥5 = ğŸ
0

-1

-2

level
sets of

-3

-4
-4

-3

-2

-1

0

1

2

3

-2

ğ‘‰

-3

4

1
ğ‘‰ = ğ¸ = ğ‘šğ‘™ $ ğœƒÌ‡ $ + ğ‘šğ‘™ğ‘”> (1 âˆ’ cos ğœƒ) â‰¥ 0
2
ğ‘‰Ì‡ = ğœƒÌ‡ ğ‘šğ‘™ $ ğœƒÌˆ + ğ‘šğ‘™ğ‘”> sin ğœƒ = âˆ’ğ‘ ğœƒÌ‡ $ â‰¤ 0

Robotics 2

-2

-1

0

1

2

3

theta

theta

â‡’ use LaSalle: ğ‘‰Ì‡ = 0 â‡” ğœƒÌ‡ = 0 â‡’ ğœƒÌˆ = âˆ’

-3

ğ‘‰ = 0 â‡” ğ‘¥5 = ğœƒ5 , ğœƒÌ‡5 = (0,0)

â‡’
nO
o

â‡’

stability of equilibrium ğ‘¥5 = 0
(â€¦ at least!)

sin ğœƒ â‰  0 unless ğœƒ = ğœƒ5 = 0 (or ğœ‹ !)
local asymptotic stability

9

Stability of dynamical systems
results - 3

Â§ previous results are also valid for periodic time-varying systems

ğ‘¥Ì‡ = ğ‘“ ğ‘¥, ğ‘¡ = ğ‘“ ğ‘¥, ğ‘¡ + ğ‘‡t â‡’ ğ‘‰ ğ‘¥, ğ‘¡ = ğ‘‰ ğ‘¥, ğ‘¡ + ğ‘‡t
Â§ for general time-varying systems (e.g., in robot trajectory tracking control)

ğ‘¥Ì‡ = ğ‘“(ğ‘¥, ğ‘¡)

Barbalat Lemma
if i) a function ğ‘‰ ğ‘¥, ğ‘¡ is lower bounded
ii) ğ‘‰Ì‡ ğ‘¥, ğ‘¡ â‰¤ 0
then â‡’ âˆƒ lim ğ‘‰ ğ‘¥, ğ‘¡ (but this does not imply that lim ğ‘‰Ì‡ ğ‘¥, ğ‘¡ = 0)
Nâ†’s

if in addition iii) ğ‘‰Ìˆ ğ‘¥, ğ‘¡ is bounded

Nâ†’s

then â‡’ lim ğ‘‰Ì‡ ğ‘¥, ğ‘¡ = 0
Nâ†’s

Corollary
if a Lyapunov candidate ğ‘‰(ğ‘¥, ğ‘¡) satisfies Barbalat Lemma along the
trajectories of ğ‘¥Ì‡ = ğ‘“(ğ‘¥, ğ‘¡), then the conclusions of LaSalle Theorem hold
Robotics 2

10

Stability of linear systems
time-invariant case

ğ‘¥Ì‡ = ğ´ğ‘¥
I.

ğ‘¥5 = 0 is always an equilibrium state

asymptotic stability

II. global asymptotic stability
III. exponential stability

IV. ğœ(ğ´) âŠ‚ â„‚/ (all eigenvalues of ğ´ have negative real part)
V.

âˆ€ğ‘„ > 0 (positive definite), âˆƒ! ğ‘ƒ > 0: ğ´Y ğ‘ƒ + ğ‘ƒğ´ = âˆ’ğ‘„
Lyapunov equation

# Y
ğ‘¥
ğ‘ƒğ‘¥
$

is a Lyapunov candidate

ALL EQUIVALENT !!
if ğ‘¥5 = 0 is an asymptotically stable equilibrium,
then it is necessarily the unique equilibrium
Robotics 2

11

Stability of the linear approximation
|}
Ì‡
Let âˆ†ğ‘¥ = ğ‘¥ âˆ’ ğ‘¥5 and let âˆ†ğ‘¥ =
|
ğ‘¥ âˆ’ ğ‘¥5 = ğ´ âˆ†ğ‘¥ be the
|~ ~â‚¬~â€¢

linear approximation of ğ‘¥Ì‡ = ğ‘“(ğ‘¥) around the equilibrium ğ‘¥5

ğ´ asymptotically stable (ğœ(ğ´) âŠ‚ â„‚/)

the original nonlinear system is
exponentially stable at the origin
this is only a local result
(used also to estimate the domain of attraction)
Robotics 2

12

PD control

(proportional + derivative action on the error)
robot ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘ ğ‘, ğ‘Ì‡ + ğ‘” ğ‘ = ğ‘¢
goal: asymptotic stabilization (= regulation)
of the closed-loop equilibrium state

ğ‘ = ğ‘| , ğ‘Ì‡ = 0
possibly obtained from kinematic inversion: ğ‘| = ğ‘“ /#(ğ‘Ÿ| )

control law ğ‘¢ = ğ¾Æ’ ğ‘| âˆ’ ğ‘ âˆ’ ğ¾â€ ğ‘Ì‡

ğ¾Æ’ > 0, ğ¾â€ > 0 (positive definite), symmetric
Robotics 2

13

Asymptotic stability with PD control
Theorem 1
In the absence of gravity (ğ‘”(ğ‘) = 0), the robot state (ğ‘| , 0) under
the given PD joint control law is globally asymptotically stable
Proof

let ğ‘’ = ğ‘| âˆ’ ğ‘
1 Y
1 Y
Lyapunov candidate ğ‘‰ = ğ‘Ì‡ ğ‘€ ğ‘ ğ‘Ì‡ + ğ‘’ ğ¾Æ’ ğ‘’ â‰¥ 0
2
2

(ğ‘| constant)
ğ‘‰ = 0 â‡” ğ‘’ = ğ‘’Ì‡ = 0

#
#
ğ‘‰Ì‡ = ğ‘Ì‡ Y ğ‘€ ğ‘Ìˆ + ğ‘Ì‡ Y ğ‘€Ì‡ ğ‘Ì‡ âˆ’ ğ‘’ Y ğ¾Æ’ ğ‘Ì‡ = ğ‘Ì‡ Y ğ‘¢ âˆ’ ğ‘† ğ‘Ì‡ + ğ‘€Ì‡ ğ‘Ì‡ âˆ’ ğ‘’ Y ğ¾Æ’ ğ‘Ì‡
$

$

= 0, due to energy conservation

= ğ‘Ì‡ Y ğ¾Æ’ ğ‘’ âˆ’ ğ‘Ì‡ Y ğ¾â€ ğ‘Ì‡ âˆ’ ğ‘’ Y ğ¾Æ’ ğ‘Ì‡ = âˆ’ğ‘Ì‡ Y ğ¾â€ ğ‘Ì‡ â‰¤ 0
up to here, we proved
stability only
Robotics 2

but

(ğ¾â€ > 0, symmetric)

ğ‘‰Ì‡ = 0 â‡” ğ‘Ì‡ = 0

continues ...
14

Asymptotic stability with PD control
LaSalle

ğ‘‰Ì‡ = 0 â‡” ğ‘Ì‡ = 0

ğ‘Ì‡ = 0

system trajectories converge to the largest
invariant set of states â„³ where ğ‘Ì‡ â‰¡ 0
(that is ğ‘Ì‡ = ğ‘Ìˆ = 0)

ğ‘€ ğ‘ ğ‘Ìˆ = ğ¾Æ’ ğ‘’

ğ‘Ìˆ = ğ‘€/# (ğ‘)ğ¾Æ’ ğ‘’

closed-loop dynamics

invertible

ğ‘Ì‡ = 0, ğ‘Ìˆ = 0 â‡” ğ‘’ = 0
the only invariant state in ğ‘‰Ì‡ = 0 is given by ğ‘ = ğ‘| , ğ‘Ì‡ = 0
note: typically, ğ¾Æ’ = diag ğ‘˜Æ’Å  , ğ¾â€ = diag ğ‘˜â€Å  ,
decentralized linear control (local to each joint)
Robotics 2

15

Mechanical interpretation
n

for diagonal positive definite gain matrices ğ¾Æ’ and ğ¾â€ (thus, with
positive diagonal elements), such values correspond to stiffness of
â€œvirtualâ€ springs and viscosity of â€œvirtualâ€ dampers placed at the joints
stiffness ğ‘˜Æ’Å  > 0
viscosity ğ‘˜â€Å  > 0

desired
configuration ğ‘|

Robotics 2

ğ‘| (single components

are defined relative
to the previous link!!)

current
configuration ğ‘

16

Plot of the Lyapunov function ğ‘‰
n

ğ‘‰
ğ‘‰(0)

time evolution of the Lyapunov candidate
ğ‘‰(0) = Â½ ğ‘’ Y (0)ğ¾Æ’ ğ‘’(0)

if the robot starts from rest

ğ‘‰Ì‡ = 0

(isolated) instants of global â€œmotion inversionâ€
(ğ‘Ì‡ = 0, but ğ‘Ìˆ â‰  0!)
Robotics 2

ğ‘¡

0

17

Comments on PD control
n

-1

choice of control gains affects robot evolution during transients and
practical settling times
n hard to define values that are â€œoptimalâ€ in the whole workspace
â€œfullâ€ ğ¾Æ’ and ğ¾â€ gain matrices allow to assign desired eigenvalues
to the linear approximation of the robot dynamics around the final
desired state (ğ‘| , 0)
when (joint) viscous friction is present, the derivative term in the
control law is not strictly necessary
n

n

n

n

âˆ’ğ¹â€¢ ğ‘Ì‡ in the robot model acts similarly to âˆ’ğ¾â€ ğ‘Ì‡ in the control law,

but the latter can be modulated at will
in the absence of tachometers, the actual realization of the derivative
term in the feedback law requires some processing of joint position
data measured by digital encoders (or analog resolvers/potentiometers)

Robotics 2

18

Comments on PD control
n

-2

analog or digital implementation of derivative action in the control law
when only position is measured at the joints (e.g., through encoders)

continuous-time
control law (design)
representation in
the Laplace domain

ğ‘¢ ğ‘¡ = ğ¾Æ’ ğ‘’ ğ‘¡ + ğ¾â€ ğ‘’(ğ‘¡)
Ì‡
ğ‘¢ ğ‘  = ğ¾Æ’ + ğ¾â€ ğ‘  ğ‘’(ğ‘ )
not realizable as such
(non-proper transfer function)

transformation in
the Zeta-domain

1 âˆ’ ğ‘§ /#
(e.g., via backward ğ‘¢ ğ‘§ = ğ¾Æ’ + ğ¾â€
ğ‘‡â€¢
differentiation rule on

Robotics 2

ğ¾â€ ğ‘ 
ğ‘¢ ğ‘  = ğ¾Æ’ +
ğ‘’(ğ‘ )
1 + ğœğ‘ 
derivative action limited
in bandwidth (up to Ï‰ â‰¤ 1/ğœ)

ğ‘’(ğ‘§)

samples, every ğ‘‡â€¢ sec)

discrete-time
implementations

ğ‘’ = ğ‘| âˆ’ ğ‘, ğ‘’Ì‡ = âˆ’ğ‘Ì‡

ğ‘’â€™ âˆ’ ğ‘’â€™/#
ğ‘¢â€™ = ğ¾Æ’ ğ‘’â€™ + ğ¾â€
ğ‘‡â€¢
both realizable

ğ‘¢ ğ‘§ =

1 âˆ’ ğ‘§ /#
ğ‘‡â€¢
ğ¾Æ’ + ğ¾â€
1 âˆ’ ğ‘§ /#
1+ğœ
ğ‘‡â€¢

ğ‘¢â€™ = ğ¾Æ’ ğ‘’â€™ +
+

ğ‘’(ğ‘§)

ğ¾â€
ğ‘’â€™ âˆ’ ğ‘’â€™/#
ğœ + ğ‘‡â€¢

ğœ
(ğ‘¢â€™/# âˆ’ ğ¾Æ’ ğ‘’â€™/# )
ğœ + ğ‘‡â€¢

19

Inclusion of gravity
n

in the presence of gravity, the same previous arguments
(and proof) show that the control law
ğ‘¢ = ğ¾Æ’ ğ‘| âˆ’ ğ‘ âˆ’ ğ¾â€ ğ‘Ì‡ + ğ‘”(ğ‘)
ğ¾Æ’ > 0, ğ¾â€ > 0
will make the equilibrium state (ğ‘| , 0) globally
asymptotically stable (nonlinear cancellation of gravity)

Â§ if gravity is not cancelled or only approximately cancelled
ğ‘¢ = ğ¾Æ’ ğ‘| âˆ’ ğ‘ âˆ’ ğ¾â€ ğ‘Ì‡ + ğ‘”(ğ‘)
â€
ğ‘”(ğ‘)
â€
â‰  ğ‘”(ğ‘)
it is ğ‘ â†’ ğ‘âˆ— â‰  ğ‘| , ğ‘Ì‡ â†’ 0, with steady-state position error
n

ğ‘ âˆ— is not unique in general, except when ğ¾Æ’ is chosen large enough

n

explanation in terms of linear systems: there is no integral action before
the point of access of the constant â€œdisturbanceâ€ acting on the system

Robotics 2

20

PD control +
constant gravity compensation
since ğ‘”(ğ‘) contains only trigonometric and/or linear terms in ğ‘,
the following structural property holds

ğœ•$ğ‘ˆ
ğœ•ğ‘”
âˆƒğ›¼ > 0:
=
â‰¤ ğ›¼, âˆ€ğ‘
$
ğœ•ğ‘
ğœ•ğ‘

finite
consequence
note:

induced
norm of
a matrix

ğ‘” ğ‘ âˆ’ ğ‘”(ğ‘| ) â‰¤ ğ›¼ ğ‘ âˆ’ ğ‘|
ğ´ = ğœ†â€¢â€“â€” ğ´Y ğ´ â‰œ ğ´â„¢ â‰¥ ğ´Å¡ â‰œ ğœ†â€¢â€ºÅ“(ğ´Y ğ´)

LINEAR CONTROL law
ğ‘¢ = ğ¾Æ’ ğ‘| âˆ’ ğ‘ âˆ’ ğ¾â€ ğ‘Ì‡ + ğ‘”(ğ‘| )

ğ¾Æ’ , ğ¾â€ > 0
symmetric

linear feedback + constant feedforward
Robotics 2

21

PD control + constant gravity compensation
stability analysis

Theorem 2
If ğ¾Æ’,Å¡ > ğ›¼ , the state (ğ‘| , 0) of the robot under joint-space PD control
+ constant gravity compensation at ğ‘| is globally asymptotically stable

Proof
1.

(ğ‘| , 0) is the unique closed-loop equilibrium state

in fact, for ğ‘Ì‡ = 0 and ğ‘Ìˆ = 0, it is ğ¾Æ’ ğ‘’ = ğ‘”(ğ‘) âˆ’ ğ‘”(ğ‘| )
which can hold only for ğ‘ = ğ‘| , because when ğ‘ â‰  ğ‘|

ğ¾Æ’ ğ‘’ â‰¥ ğ¾Æ’,Å¡ ğ‘’ > ğ›¼ ğ‘’ â‰¥ ğ‘” ğ‘ âˆ’ ğ‘”(ğ‘| )

Robotics 2

22

PD control + constant gravity compensation
stability analysis

with ğ‘’ = ğ‘| âˆ’ ğ‘, ğ‘” ğ‘ =
ğ‘‰=

1 Y
1
ğ‘Ì‡ ğ‘€ ğ‘ ğ‘Ì‡ + ğ‘’ Y ğ¾Æ’ ğ‘’ + ğ‘ˆ ğ‘ âˆ’ ğ‘ˆ ğ‘| + ğ‘’ Y ğ‘”(ğ‘| )
2
2

ğ‘‰ is convex in ğ‘Ì‡ and ğ‘’, and zero only for ğ‘’ = ğ‘Ì‡ = 0

2.

â€¢ Y
Â¢Ì‡
Â£â€¢

Â¢Ì‡ Â£
Y
â€¢|Â¤Â¥O
Ì‡
5
Â£â€¢
Ì‡
|Â¤Â¥O
5Â£

Robotics 2

Â¡ Y
, consider as Lyapunov candidate
Â¢

= ğ‘€ ğ‘ ğ‘Ì‡ = 0 only for ğ‘Ì‡ = 0
=ğ‘€ ğ‘ >0

global minimum
of ğ‘‰ â‰¥ 0

Â¡ Y
Â¢

= ğ¾Æ’ ğ‘’ âˆ’
= ğ¾Æ’ +

(ğ‘| , 0) is a

+ ğ‘” ğ‘| = ğ¾Æ’ ğ‘’ + ğ‘” ğ‘| âˆ’ ğ‘” ğ‘ = 0
only for ğ‘ = ğ‘|
ğœ•ğ‘’ â„ğœ•ğ‘ = âˆ’ğ¼

Â£Â¡

Â¢Â£

> 0, since ğ¾Æ’ = ğ¾Æ’,â„¢ â‰¥ ğ¾Æ’,Å¡ > ğ›¼
23

PD control + constant gravity compensation
stability analysis

differentiating

1 Y
1 Y
ğ‘‰ = ğ‘Ì‡ ğ‘€ ğ‘ ğ‘Ì‡ + ğ‘’ ğ¾Æ’ ğ‘’ + ğ‘ˆ ğ‘ âˆ’ ğ‘ˆ ğ‘| + ğ‘’ Y ğ‘”(ğ‘| )
2
2

1
ğœ•ğ‘ˆ(ğ‘)
Y
Y
Ì‡
Ì‡
ğ‘‰ = ğ‘Ì‡ ğ‘€(ğ‘)ğ‘Ìˆ + ğ‘€(ğ‘)ğ‘Ì‡ âˆ’ ğ‘’ ğ¾Æ’ ğ‘Ì‡ +
ğ‘Ì‡ âˆ’ ğ‘Ì‡ Y ğ‘”(ğ‘| )
2
ğœ•ğ‘
1
Y
Ì‡
= ğ‘Ì‡ ğ‘¢ âˆ’ ğ‘†(ğ‘, ğ‘)
Ì‡ ğ‘Ì‡ + ğ‘€(ğ‘)
ğ‘Ì‡ âˆ’ ğ‘”(ğ‘) âˆ’ ğ‘’ Y ğ¾Æ’ ğ‘Ì‡ + ğ‘Ì‡ Y ğ‘” ğ‘ âˆ’ ğ‘”(ğ‘| )
2
=0

= ğ‘Ì‡ Y ğ¾Æ’ ğ‘’ âˆ’ ğ‘Ì‡ Y ğ¾â€ ğ‘Ì‡ + ğ‘Ì‡ Y ğ‘” ğ‘| âˆ’ ğ‘”(ğ‘) âˆ’ ğ‘’ Y ğ¾Æ’ ğ‘Ì‡ + ğ‘Ì‡ Y ğ‘” ğ‘ âˆ’ ğ‘”(ğ‘| )
= âˆ’ğ‘Ì‡ Y ğ¾â€ ğ‘Ì‡ â‰¤ 0
for ğ‘‰Ì‡ = 0 (â‡” ğ‘Ì‡ = 0), we have in the closed-loop system
ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘” ğ‘ = ğ¾Æ’ ğ‘’ + ğ‘”(ğ‘| )
ğ‘Ìˆ = ğ‘€ /# ğ‘ ğ¾Æ’ ğ‘’ + ğ‘” ğ‘| âˆ’ ğ‘” ğ‘

=0â‡”ğ‘’=0

by LaSalle Theorem, the thesis follows
Robotics 2

24

Example of a single-link robot
stability analysis

task: regulate the link position to the upward equilibrium

ğœƒ| = ğœ‹ â†’ ğ‘” ğœƒ| = 0
PD control + constant gravity compensation (here, zero!)

ğ‘¢ = ğ‘˜Æ’ ğœ‹ âˆ’ ğœƒ âˆ’ ğ‘˜â€ ğœƒÌ‡
by Theorem 2, it is sufficient (here, also necessary*) to choose

ğ¼ğœƒÌˆ + ğ‘šğ‘”> ğ‘‘ sin ğœƒ = ğ‘¢

ğ‘˜Æ’ > ğ›¼ = ğ‘šğ‘”> ğ‘‘, ğ‘˜â€ > 0
single
minimum
in ğœƒ| = ğœ‹

two local minima

ğ‘˜Æ’
Â©ğ‘šğ‘” ğ‘‘ = 0.5
>

ğ‘˜Æ’
Â©ğ‘šğ‘” ğ‘‘ = 1
>

plots of ğ‘‰(ğœƒ) (for ğœƒÌ‡ = 0)
Robotics 2

ğ‘˜Æ’
Â©ğ‘šğ‘” ğ‘‘ = 5
>
* by a local analysis of the
linear approximation at ğœ‹

rad

25

Example of a single-link robot
simulations with data: ğ¼ = 0.9333, ğ‘šğ‘”>ğ‘‘ = 19.62 (= ğ›¼)
ğœƒ| = 90Â° â†’ ğ‘” ğœƒ| = ğ‘šğ‘”> ğ‘‘
low P gain: ğ‘˜Æ’ = 16, ğ‘˜â€ = 8

error

velocity

position

ğœƒ| = 180Â° â†’ ğ‘” ğœƒ| = 0
sufficient P gain: ğ‘˜Æ’ = 36, ğ‘˜â€ = 12
low P gain: ğ‘˜Æ’ = 16, ğ‘˜â€ = 8

zero final error

control

large initial torque

Robotics 2

o

60 residual error

small initial torque

no residual error!

even smaller initial torque

26

Approximate gravity compensation
the approximate control law

ğ‘¢ = ğ¾Æ’ ğ‘| âˆ’ ğ‘ âˆ’ ğ¾â€ ğ‘Ì‡ + ğ‘”(ğ‘
â€ |)
leads, under similar hypotheses, to a closed-loop equilibrium ğ‘âˆ—
Â§ its uniqueness is not guaranteed (unless ğ¾Æ’ is large enough)
Â§ for ğ¾Æ’ â†’ âˆ, one has ğ‘âˆ— â†’ ğ‘|

Conclusion: In the presence of gravity, the previous regulation control laws
require an accurate knowledge of the gravity term in the dynamic model
in order to guarantee the zeroing of the position error
(since we can only use â€œfiniteâ€ control gains â‡’ in practice, not too large)

Robotics 2

27

PID control
n

n

in linear systems, the addition of an integral control action is used
to eliminate a constant error in the step response at steady state
in robots, a PID may be used to recover such a position error due
to an incomplete (or absent) gravity compensation/cancellation
N

the control law ğ‘¢ ğ‘¡ = ğ¾Æ’ ğ‘| âˆ’ ğ‘(ğ‘¡) + ğ¾Â± Â² ğ‘| âˆ’ ğ‘(ğœ) ğ‘‘ğœ âˆ’ ğ¾â€ ğ‘(ğ‘¡)
Ì‡
>

n
n

is independent from any robot dynamic model term
if the desired closed-loop equilibrium is asymptotically stable under
PID control, the integral term is â€œloadedâ€ at steady state to the value
s

ğ¾Â± Â²

>

n

ğ‘| âˆ’ ğ‘(ğœ) ğ‘‘ğœ = ğ‘”(ğ‘| )

however, one can show only local asymptotic stability of this law, i.e.,
for ğ‘(0) âˆˆ Î”(ğ‘| ), under complex conditions on ğ¾Æ’ , ğ¾Â± , ğ¾â€ and ğ‘’(0)

Robotics 2

28

Linear example with PID control
whiteboardâ€¦

ğ‘šğ‘Ìˆ + ğ‘šğ‘”> = ğ¹

ğ‘”> > 0
ğ‘š

ğ‘

(no friction)

ğ‘’ ğ‘¡ = ğ‘| âˆ’ ğ‘ ğ‘¡
ğ‘’Ì‡ ğ‘¡ = âˆ’ğ‘Ì‡ ğ‘¡

ğ¹ = ğ‘˜Æ’ ğ‘| âˆ’ ğ‘ âˆ’ ğ‘˜â€ ğ‘Ì‡
(PD â‡’ steady-state error ğ‘’ = ğ‘| âˆ’ ğ‘
Â³ , with ğ‘Â³ =

ğ¹

ğ¹ = ğ‘˜Æ’ ğ‘| âˆ’ ğ‘ âˆ’ ğ‘˜â€ ğ‘Ì‡ + ğ‘šğ‘”>

Å¡nO
ğ‘| âˆ’ â€™ )
Â´

(PD + gravity cancellation â‡’ regulation âˆ€ğ‘˜Æ’ > 0, ğ‘˜â€ > 0)
N

ğ¹ = ğ‘˜Æ’ ğ‘| âˆ’ ğ‘ âˆ’ ğ‘˜â€ ğ‘Ì‡ + ğ‘˜Â± Â² ğ‘| âˆ’ ğ‘(ğœ) ğ‘‘ğœ
>

(PID â‡’ regulation âˆ€ğ‘˜Â± > 0, ğ‘˜â€ > 0, ğ‘˜Æ’ >

Å¡â€™Âµ
â€™Â¶

> 0)

Laplace domain analysis: ğ‘’ ğ‘  = â„’[ğ‘’ ğ‘¡ ], ğ‘‘ ğ‘  = â„’[ğ‘šğ‘”>] + Routh criterion

ğ‘’(ğ‘ )
ğ‘ 
= ğ‘Š| ğ‘  =
ğ‘‘(ğ‘ )
ğ‘šğ‘  U + ğ‘˜â€ ğ‘  $ + ğ‘˜Æ’ ğ‘  + ğ‘˜Â±
Robotics 2

3
2
1 (ğ‘˜â€ ğ‘˜Æ’
0

ğ‘š
ğ‘˜Æ’
ğ‘˜â€
ğ‘˜Â±
âˆ’ ğ‘šğ‘˜Â± )/ğ‘˜â€
ğ‘˜Â±

29

Saturated PID control
Â§ more in general, one can prove global asymptotic stability of (ğ‘| , 0),
under lower bound limitations for ğ¾Æ’ , ğ¾Â± , ğ¾â€ (depending on suitable
â€œboundsâ€ on the terms in the dynamic model), for a nonlinear PID law
N

ğ‘¢ ğ‘¡ = ğ¾Æ’ ğ‘| âˆ’ ğ‘(ğ‘¡) + ğ¾Â± Â² Î¦ ğ‘| âˆ’ ğ‘(ğœ) ğ‘‘ğœ âˆ’ ğ¾â€ ğ‘Ì‡
>

where Î¦(ğ‘| âˆ’ ğ‘) is a saturation-type function, such as

sin ğ‘¥ ,
Î¦ ğ‘¥ = Â¾ 1,
âˆ’1,

ğ‘¥ â‰¤ ğœ‹/2
ğ‘¥ > ğœ‹/2
ğ‘¥ < âˆ’ğœ‹/2

or

ğ‘’ ~ âˆ’ ğ‘’ /~
Î¦ ğ‘¥ = tanh ğ‘¥ = ~
ğ‘’ + ğ‘’ /~

(see paper by R. Kelly, IEEE TAC, 1998; available as extra material on the course web)
Robotics 2

30

Limits of robot regulation controllers
n

n

response times needed for reaching the desired steady state are not
easily predictable in advance
n depend heavily on robot dynamics, on PD/PID gains, on the required
total displacement, and on the interested area of robot workspace
n integral term (when present) needs some time to â€œunloadâ€ itself from
the error history accumulated during transients
n large initial errors are stored in the integral term
n anti-windup schemes stop the integration when commands saturate
n â€¦ an intuitive explanation for the success of â€œsaturatedâ€ PID law
control efforts in the few first instants of motion typically exceed by far
those required at steady state
n especially for high positional gains
n may lead to saturation (hard nonlinearity) of robot actuators

Robotics 2

31

Regulation in industrial robots
n

in industrial robots, the planner generates a reference trajectory ğ‘Â¿ (ğ‘¡)
even when the task requires only positioning/regulation of the robot
n
n

â€œsmoothâ€ enough, with a user-defined transfer time ğ‘‡
reference trajectory interpolates initial and final desired position

ğ‘Â¿ (0) = ğ‘(0)
n

ğ‘Â¿ (ğ‘¡ â‰¥ ğ‘‡) = ğ‘|

ğ‘Â¿ (ğ‘¡) is used within a control law of the form

ğ‘¢ = ğ¾Æ’ ğ‘Â¿ (ğ‘¡) âˆ’ ğ‘ + ğ¾â€ ğ‘Ì‡ Â¿ (ğ‘¡) âˆ’ ğ‘Ì‡ + ğ‘”(ğ‘)

e.g., PD with
gravity
cancellation

often neglected
n
n

n

Robotics 2

in this way, the position error is initially zero
robot motion stays only â€œin the vicinityâ€ of the reference trajectory
until ğ‘¡ = ğ‘‡, typically with small position errors (gains can be larger!)
final regulation is only a â€œlocalâ€ problem (ğ‘’ ğ‘‡ = ğ‘| âˆ’ ğ‘(ğ‘‡) is small)
32

Qualitative comparison
no saturation of commands: in principle, much larger gains can be used
better prediction of settling times: local exponential convergence (designed
on the linear approximation of the robot dynamics around (ğ‘| , 0))
â€œfine tuningâ€ of control gains is easier, but still a tedious and delicate task

n
n

n

step ğ‘¢(0)
variation
of desired
position

ğ‘ğ‘‘

ğ‘¢| = ğ‘”(ğ‘| )

ğ‘(0)

joint variables
ğ‘ğ‘‘

timevarying
position
reference

ğ‘Â¿ (ğ‘¡) ğ‘¢(0)

ğ‘(0)

control commands

ğ‘¢| = ğ‘”(ğ‘| )

ğ‘‡ = planned
final time

Robotics 2

33

Quantitative comparison
planar 2R arm

robot data: links are uniform thin rods
no gravity (horizontal plane)
rest-to-rest motion task:
ğ‘(0) = (0, 0) (straight) â†’ ğ‘| = (ğœ‹/3, ğœ‹/2)
interpolating trajectory: cubic polynomials
three case studies
a) low gains (overdamped) ğ¾Æ’ = diag 80, 40 , ğ¾â€ = diag 60, 30
vs interpolating trajectory in ğ‘‡ = 2 s
b) medium gains (very overdamped) ğ¾Æ’ = diag 200, 100 , ğ¾â€ = diag 200, 100
vs interpolating trajectory in ğ‘‡ = 2 s
c) high gains ğ¾Æ’ = diag 1250, 180 , ğ¾â€ = diag 200, 70
vs interpolating trajectory in ğ‘‡ = 1 s, with torque saturation ğ‘¢#,â€¢â€“â€” = 30 Nm,
ğ‘¢$,â€¢â€“â€” = 10 Nm
Robotics 2

34

Comparison on a planar 2R arm â€“ case a

PD with low gains
ğ¾Æ’ = diag 80, 40
ğ¾â€ = diag 60, 30
(overdamped)
a reduction of the
peak control effort
by a factor of 100
on joint 1 &
by a factor of 30
on joint 2
PD with same gains
on interpolating
trajectory of ğ‘‡ = 2 s

Robotics 2

max torques
of 7 and 2.3 Nm

35

Comparison on a planar 2R arm â€“ case b

PD with medium gains
ğ¾Æ’ = diag 200, 100
ğ¾â€ = diag 200, 100
(very overdamped)

PD with same gains
on interpolating
trajectory of ğ‘‡ = 2 s

Robotics 2

even stronger
peak reduction,
with similar total
control effort,
plus improved
tracking of
reference trajectory
on both joints
max torques
of 7.5 and 2.4 Nm

36

Comparison on a planar 2R arm â€“ case c

PD with high gains
ğ¾Æ’ = diag 1250, 180
ğ¾â€ = diag 200, 70

torque saturation
ğ‘¢#,â€¢â€“â€” = 30 Nm
ğ‘¢$,â€¢â€“â€” = 10 Nm

PD with same gains
on interpolating
trajectory of ğ‘‡ = 1 s

Robotics 2

position overshoot
and long saturations
are avoided,
with very good
tracking of the
faster reference
trajectory
max torques
of 30 and 9.5 Nm

37

