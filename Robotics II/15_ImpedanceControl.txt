Robotics 2

Impedance Control
Prof. Alessandro De Luca

Impedance control
n

n

n

n

n

n

imposes a desired dynamic behavior to the interaction between
robot end-effector and environment
the desired performance is specified through a generalized dynamic
impedance, namely a complete set of mass-spring-damper equations
(typically chosen as linear and decoupled, but also nonlinear)
a model describing how reaction forces are generated in association
with environment deformation is not explicitly required
suited for tasks in which contact forces should be â€œkept smallâ€, while
their accurate regulation is not mandatory
since a control loop based on force error is missing, contact forces
are only indirectly assigned by controlling position
the choice of a specific stiffness in the impedance model along a
Cartesian direction results in a trade-off between contact forces and
position accuracy in that direction

Robotics 2

2

Dynamic model of a robot in contact
ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘† ğ‘, ğ‘Ì‡ ğ‘Ì‡ + ğ‘” ğ‘ = ğ‘¢ + ğ½. ğ‘ ğ¹

ğ‘ âˆˆ â„5

forces

linear velocity

â€œgeometricâ€
Jacobian

generalized
Cartesian force
â€œanalyticâ€
Jacobian

ğ‘Ì‡
ğ‘£
ğ‘“
8
ğ¹=
âˆˆ â„ performing work on ğ‘‰ = ğœ” = ğ½ ğ‘ ğ‘Ì‡ â‰  ğ‘¥Ì‡ = Ì‡ = ğ½- (ğ‘)ğ‘Ì‡
ğœ™
ğ‘š
torques

direct kinematics

angular velocity

ğœ•ğ‘“(ğ‘)
ğ½- ğ‘ =
= ğ‘‡- ğœ™ ğ½(ğ‘)
ğœ•ğ‘

derivative of
Euler angles

ğ‘¥Ì‡ = ğ‘‡- ğœ™ ğ‘‰

ğ‘€ ğ‘ ğ‘Ìˆ + ğ‘† ğ‘, ğ‘Ì‡ ğ‘Ì‡ + ğ‘” ğ‘ = ğ‘¢ + ğ½-. ğ‘ ğ¹-

with

ğ¹- = ğ‘‡-1. ğœ™ ğ¹

generalized forces performing work on ğ‘¥Ì‡
Robotics 2

3

Dynamic model in Cartesian coordinates
assuming

ğ‘›=ğ‘š

ğ‘€A ğ‘ ğ‘¥Ìˆ + ğ‘†A ğ‘, ğ‘Ì‡ ğ‘¥Ì‡ + ğ‘”A ğ‘ = ğ½-1. ğ‘ ğ‘¢ + ğ¹with

ğ‘€A ğ‘ = ğ½-1. (ğ‘)ğ‘€(ğ‘)ğ½-1F(ğ‘)
ğ‘†A ğ‘, ğ‘Ì‡ = ğ½-1. ğ‘ ğ‘† ğ‘, ğ‘Ì‡ ğ½-1F ğ‘ âˆ’ ğ‘€A (ğ‘)ğ½-Ì‡ (ğ‘)ğ½-1F(ğ‘)
ğ‘”A ğ‘ = ğ½-1. (ğ‘)ğ‘”(ğ‘)
... and the usual structural properties

Â§ ğ‘€A > 0, if ğ½- is non-singular
Â§ ğ‘€Ì‡ A âˆ’ 2ğ‘†A is skew-symmetric, if ğ‘€Ì‡ âˆ’ 2ğ‘† satisfies the
same property
Â§ the Cartesian dynamic model of the robot can be linearly
parameterized in terms of a set of dynamic coefficients
Robotics 2

4

Design of the control law
designed in two steps:
1. feedback linearization in the Cartesian space (with force measure)

ğ‘¢ = ğ½-. (ğ‘) ğ‘€A ğ‘ ğ‘ + ğ‘†A ğ‘, ğ‘Ì‡ ğ‘¥Ì‡ + ğ‘”A ğ‘ âˆ’ ğ¹ğ‘¥Ìˆ = ğ‘

closed-loop system

2. imposition of a dynamic impedance model
most of the times
it is â€œdecoupledâ€
(diagonal matrices)

ğ‘€8 ğ‘¥Ìˆ âˆ’ ğ‘¥Ìˆ H + ğ·8 ğ‘¥Ì‡ âˆ’ ğ‘¥Ì‡ H + ğ¾8 ğ‘¥ âˆ’ ğ‘¥H = ğ¹-

desired (apparent)
desired
inertia (> 0)
damping (â‰¥ 0)

desired
stiffness (> 0)

external forces
from the environment

is realized by choosing
1F ğ· ğ‘¥Ì‡ âˆ’ ğ‘¥Ì‡ + ğ¾ ğ‘¥ âˆ’ ğ‘¥ + ğ¹
ğ‘ = ğ‘¥Ìˆ H + ğ‘€8
8 H
8 H
-

Note: ğ‘¥H (ğ‘¡) is the desired motion, which typically â€œslightly penetratesâ€
inside the compliant environment (inducing contact forces)...
Robotics 2

5

Examples of desired reference ğ‘¥ğ‘‘
in impedance/compliance control

ğ‘€8 ğ‘¥Ìˆ âˆ’ ğ‘¥Ìˆ H + ğ·8 ğ‘¥Ì‡ âˆ’ ğ‘¥Ì‡ H + ğ¾8 ğ‘¥ âˆ’ ğ‘¥H = ğ¹the desired motion ğ’™ğ’… (ğ’•) is slightly inside
the environment (keeping thus contact)

ğ’™ğ’†

ğ’™ğ’…(ğ’•)

ğ’™ğ’…(ğ’•)
robot in grinding task
Robotics 2

robot writing on a surface
6

Examples of desired reference ğ‘¥ğ‘‘
in impedance/compliance control

ğ‘€8 ğ‘¥Ìˆ âˆ’ ğ‘¥Ìˆ H + ğ·8 ğ‘¥Ì‡ âˆ’ ğ‘¥Ì‡ H + ğ¾8 ğ‘¥ âˆ’ ğ‘¥H = ğ¹constant desired pose ğ’™ğ’… is the free Cartesian
rest position in a human-robot interaction task

ğ’™ğ’…
ğ’™ğ’…

KUKA iiwa robot with human operator
Robotics 2

KUKA LWR robot in pHRI (collaboration)
7

Control law in joint coordinates
substituting and simplifyingâ€¦
1F ğ· ğ‘¥Ì‡ âˆ’ ğ‘¥Ì‡ + ğ¾ ğ‘¥ âˆ’ ğ‘¥ }
ğ‘¢ = ğ‘€ ğ‘ ğ½-1F(ğ‘)Sğ‘¥Ìˆ H âˆ’ ğ½-Ì‡ ğ‘ ğ‘Ì‡ + ğ‘€8
8 H
8 H
1F âˆ’ ğ¼ ğ¹
+ ğ‘† ğ‘, ğ‘Ì‡ ğ‘Ì‡ + ğ‘” ğ‘ + ğ½-. (ğ‘) ğ‘€A ğ‘ ğ‘€8
-

matrix weighting the measured contact forces
Â§ the following identity holds for the term involving contact forces
1F âˆ’ ğ¼ ğ¹ = ğ‘€ ğ‘ ğ½1F(ğ‘)ğ‘€1F âˆ’ ğ½. ğ‘ ğ¹
ğ½-. ğ‘ ğ‘€A ğ‘ ğ‘€8
8
-

which eliminates from the control law also the appearance of the
last remaining Cartesian quantity (the Cartesian inertia matrix)
Â§ while the control design is based on dynamic analysis and desired
(impedance) behavior described in the Cartesian space, the final
control implementation is always at the robot joint level
Robotics 2

8

Choice of the impedance model
n

n

n

rationale ...
avoid large impact forces due to uncertain geometric characteristics
(position, orientation) of the environment
adapt/match to the dynamic characteristics of the environment (in
particular, of its estimated stiffness) in a complementary way
mimic the behavior of a human arm
Ã¨ fast and stiff in â€œfreeâ€ motion, slow and compliant in â€œguardedâ€ motion

n

n

n

large ğ‘€8,V and small ğ¾8,V in Cartesian directions where contact is
foreseen (â” low contact forces)
large ğ¾8,V and small ğ‘€8,V in Cartesian directions that are supposed
to be free (â” good tracking of desired motion trajectory)
damping coefficients ğ·8,V are used then to shape transient behaviors

Robotics 2

9

Human arm behavior
hard environment
expected contact motion
= soft motion control

expected free motion
= stiff motion control

in the selected ğ‘– -th Cartesian direction:
the stiffer is the environment, the softer is the chosen model stiffness ğ¾8,V
Robotics 2

10

A notable simplification

-1

choose the apparent inertia equal to the natural Cartesian inertia of the robot

ğ‘€8 = ğ‘€A ğ‘ = ğ½-1. ğ‘ ğ‘€(ğ‘)ğ½-1F(ğ‘)
then, the control law becomes

ğ‘¢ = ğ‘€ ğ‘ ğ½-1F(ğ‘)Sğ‘¥Ìˆ H âˆ’ ğ½-Ì‡ ğ‘ ğ‘Ì‡ } + ğ‘† ğ‘, ğ‘Ì‡ ğ‘Ì‡ + ğ‘” ğ‘
+ ğ½-. (ğ‘) ğ·8 ğ‘¥Ì‡ H âˆ’ ğ‘¥Ì‡ + ğ¾8 ğ‘¥H âˆ’ ğ‘¥
WITHOUT contact force feedback! (a F/T sensor is no longer neededâ€¦)

this is a pure motion control applied also during interaction,
but designed so as to keep limited contact forces at the end-effector level
(as before, ğ¾ğ‘š is chosen as a function of the expected environment stiffness)
Robotics 2

11

A notable simplification

-2

technical issue: if the impedance model (now, nonlinear) is still supposed to
represent a real mechanical system, then in correspondence to a desired
non-constant inertia (ğ‘€A (ğ‘)) there should be Coriolis and centrifugal terms...

ğ‘€A (ğ‘) ğ‘¥Ìˆ âˆ’ ğ‘¥Ìˆ H + ğ‘†A ğ‘, ğ‘Ì‡ + ğ·8 ğ‘¥Ì‡ âˆ’ ğ‘¥Ì‡ H + ğ¾8 ğ‘¥ âˆ’ ğ‘¥H = ğ¹nonlinear impedance model (â€œonlyâ€ gravity terms disappear)

redoing computations, the control law becomes

ğ‘¢ = ğ‘€ ğ‘ ğ½-1F(ğ‘)Sğ‘¥Ìˆ H âˆ’ ğ½-Ì‡ ğ‘ ğ½-1F ğ‘ ğ‘¥Ì‡ H } + ğ‘† ğ‘, ğ‘Ì‡ ğ½-1F(ğ‘)ğ‘¥Ì‡ H + ğ‘” ğ‘
+ ğ½-. (ğ‘) ğ·8 ğ‘¥Ì‡ H âˆ’ ğ‘¥Ì‡ + ğ¾8 ğ‘¥H âˆ’ ğ‘¥
which is indeed slightly more complex, but has the following advantages:
Â§ guarantee of asymptotic convergence to zero tracking error (on ğ‘¥ğ‘‘(ğ‘¡))
when ğ¹- = 0 (no contact situation) â‡’ Lyapunov + skew-symmetry of ğ‘€Ì‡ A âˆ’ 2ğ‘†A
Â§ further simplifications when ğ‘¥ğ‘‘ is constant
Robotics 2

12

Cartesian regulation revisited
(without contact, ğ¹- = 0)

when ğ‘¥ğ‘‘ is constant (ğ‘¥Ì‡ H = 0, ğ‘¥Ìˆ H = 0), from the previous expression we get
the control law

ğ‘¢ = ğ‘” ğ‘ + ğ½-. ğ‘ ğ¾8 ğ‘¥H âˆ’ ğ‘¥ âˆ’ ğ·8ğ‘¥Ì‡

(â˜…)

Cartesian PD control with gravity cancellationâ€¦
when ğ¹- = 0 (absence of contact), we know already that this control law
ensures asymptotic stability of ğ‘¥H , provided ğ½- (ğ‘) has full rank
proof

1 .
1
Lyapunov candidate ğ‘‰F = ğ‘¥Ì‡ ğ‘€A ğ‘ ğ‘¥Ì‡ + ğ‘¥H âˆ’ ğ‘¥ . ğ¾8 ğ‘¥H âˆ’ ğ‘¥
(alternative)
2
2
1 .
.
Ì‡
ğ‘‰F = ğ‘¥Ì‡ ğ‘€A ğ‘ ğ‘¥Ìˆ + ğ‘¥Ì‡ ğ‘€Ì‡ A ğ‘ ğ‘¥Ì‡ âˆ’ ğ‘¥Ì‡ . ğ¾8 ğ‘¥H âˆ’ ğ‘¥ = â‹¯ = âˆ’ğ‘¥Ì‡ . ğ·8 ğ‘¥Ì‡ â‰¤ 0
2
using skew-symmetry of ğ‘€Ì‡ A âˆ’ 2ğ‘†A and ğ‘”A = ğ½-1. ğ‘”
Robotics 2

13

Cartesian stiffness control
(with contact, ğ¹- â‰  0)

when ğ¹- â‰  0, convergence to ğ‘¥H is not assured
(it may not even be a closed-loop equilibriumâ€¦)
Â§ for analysis, assume an elastic contact model for the environment

ğ¹- = ğ¾\ (ğ‘¥\ âˆ’ ğ‘¥) with stiffness ğ¾\ â‰¥ 0 and rest position ğ‘¥\
Â§ closed-loop system behavior
Lyapunov candidate
1 .
1
1
.
ğ‘‰] = ğ‘¥Ì‡ ğ‘€A ğ‘ ğ‘¥Ì‡ + ğ‘¥H âˆ’ ğ‘¥ ğ¾8 ğ‘¥H âˆ’ ğ‘¥ + ğ‘¥\ âˆ’ ğ‘¥ . ğ¾\ ğ‘¥\ âˆ’ ğ‘¥
2
2
2
1
= ğ‘‰F + ğ‘¥\ âˆ’ ğ‘¥ . ğ¾\ ğ‘¥\ âˆ’ ğ‘¥
2
1 .
.
Ì‡
ğ‘‰] = ğ‘¥Ì‡ ğ‘€A ğ‘ ğ‘¥Ìˆ + ğ‘¥Ì‡ ğ‘€Ì‡ A ğ‘ ğ‘¥Ì‡ âˆ’ ğ‘¥Ì‡ . ğ¾8 ğ‘¥H âˆ’ ğ‘¥ âˆ’ ğ‘¥Ì‡ . ğ¾\ ğ‘¥\ âˆ’ ğ‘¥
2
= â‹¯ = âˆ’ğ‘¥Ì‡ . ğ·8 ğ‘¥Ì‡ + ğ‘¥Ì‡ . (ğ¹- âˆ’ ğ¾\ ğ‘¥\ âˆ’ ğ‘¥ ) = âˆ’ğ‘¥Ì‡ . ğ·8 ğ‘¥Ì‡ â‰¤ 0
Robotics 2

14

Stability analysis

(with ğ¹- â‰  0)

when ğ‘¥Ì‡ = ğ‘¥Ìˆ = 0, at a closed-loop system equilibrium it is
ğ¾8 (ğ‘¥H âˆ’ ğ‘¥) + ğ¾\ (ğ‘¥\ âˆ’ ğ‘¥) = 0
which has the unique solution

ğ‘¥ = ğ¾8 + ğ¾\

1F

ğ¾8ğ‘¥H + ğ¾\ ğ‘¥\ =: ğ‘¥_

(check that the Lyapunov candidate ğ‘‰2 has in fact its minimum in ğ‘¥_ !)
LaSalle

ğ‘¥_ â‰ˆ

ğ‘¥ğ¸ asymptotically stable equilibrium
ğ‘¥\ for ğ¾\ â‰« ğ¾8 (rigid environment)
ğ‘¥H for ğ¾8 â‰« ğ¾\

(rigid controller)

Note: the Cartesian stiffness control law (â˜…) is often
called compliance control in the literature
Robotics 2

15

Active equivalent of RCC device
IF Â§ displacements from the desired position ğ‘¥H are small, namely

(ğ‘¥H âˆ’ ğ‘¥) â‰ˆ ğ½- (ğ‘H âˆ’ ğ‘)
Â§ ğ‘”(ğ‘) = 0 (gravity is compensated/cancelled, e.g., mechanically)
Â§ ğ·8 = 0

ğ‘¢ = ğ½-. ğ‘ ğ¾8 ğ½- ğ‘H âˆ’ ğ‘ = ğ¾(ğ‘)(ğ‘H âˆ’ ğ‘)

THEN
ğ¾8

âˆ†ğ‘¥
ğ½- (ğ‘)
âˆ†ğ‘

ğ¾(ğ‘)

ğ¹

âˆ†ğ‘¥

constant Cartesian-level stiffness ğ¾8
corresponds to
ğ½-. (ğ‘)
ğ½-1F (ğ‘)
variable joint-level stiffness ğ¾(ğ‘)
ğ‘¢
âˆ†ğ‘
(and vice versa on compliance)

ğ¶(ğ‘¥)

ğ¹
ğ½-1. (ğ‘)

ğ¶8

ğ‘¢

is the â€˜â€˜activeâ€™â€™ counterpart of a Remote Center of Compliance (RCC) device
Robotics 2

16

Admittance control
Â§ in some cases, we donâ€™t have access to low-level robot torque (or
motor current) commands â‡’ closed control architecture
Â§ for handling the interaction with the environment, one uses then
admittance control: contact forces â‡’ velocity commands
Â§ implementation (with compliant matrices ğ¶ )
Â§ at the velocity or incremental position level
Â§ in the joint or Cartesian (or task) space

ğ‘¢e = ğ½. (ğ‘)ğ¹e âŸ¶ ğ‘Ì‡ = ğ¶g ğ‘¢e âŸ¶ ğ‘Ì‡ = ğ¶g ğ½. (ğ‘)ğ¹e
ğ¶g â‰¥ 0
â†•
âˆ†ğ‘ (to be added to the current ğ‘)
ğ¹e âŸ¶ ğ‘¥Ì‡ = ğ¶A ğ¹e âŸ¶ ğ‘Ì‡ = ğ½1F (ğ‘)ğ¶A ğ¹e
â†•
(in case of redundancy) ğ½# (ğ‘)
Robotics 2

ğ¶A â‰¥ 0

17

